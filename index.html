<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MultiGenio - Tu aliado en el aprendizaje</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary-color: #3b5998; /* Azul profundo */
      --secondary-color: #4CAF50; /* Verde vibrante */
      --accent-color: #FFC107; /* Amarillo c√°lido */
      --text-dark: #212121;
      --text-light: #616161;
      --bg-light: #f8fafd; /* Fondo muy claro, casi blanco */
      --bg-white: #ffffff;
      --shadow-light: rgba(0, 0, 0, 0.08);
      --shadow-medium: rgba(0, 0, 0, 0.15);
      --shadow-strong: rgba(0, 0, 0, 0.25);
      --border-radius-soft: 12px;
      --border-radius-medium: 20px;
      --spacing-unit: 20px; /* Base spacing */
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-light);
      color: var(--text-light);
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased; /* Better font rendering */
      -moz-osx-font-smoothing: grayscale;
    }

    /* Scrollbar Styling */
    body::-webkit-scrollbar {
        width: 10px;
    }
    body::-webkit-scrollbar-track {
        background: var(--bg-light);
        border-radius: 10px;
    }
    body::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 10px;
        border: 2px solid var(--bg-light);
    }
    body::-webkit-scrollbar-thumb:hover {
        background-color: var(--secondary-color);
    }

    /* Header */
    header {
      background: var(--bg-white);
      color: var(--text-dark);
      padding: var(--spacing-unit) calc(2 * var(--spacing-unit));
      text-align: center;
      box-shadow: 0 2px 10px var(--shadow-light);
      position: relative;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    header .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    header .logo-container img {
      height: 60px; /* Tama√±o del logo ajustado */
      width: auto;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
    }
    header h1 {
      font-size: 2.2em; /* Tama√±o del t√≠tulo en el header */
      margin: 0;
      font-weight: 700;
      color: var(--primary-color);
    }
    header p {
      font-size: 1em;
      margin: 0;
      color: var(--text-light);
    }

    /* Navigation */
    nav {
      background: var(--primary-color);
      display: flex;
      justify-content: center;
      padding: calc(0.7 * var(--spacing-unit)) 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
      flex-wrap: wrap;
      gap: 25px; /* M√°s espacio entre elementos */
      position: sticky;
      top: 0;
      z-index: 100;
    }
    nav a, nav button {
      color: var(--bg-white);
      text-decoration: none;
      font-weight: 500;
      font-size: 1.05em;
      padding: 8px 15px;
      border-radius: var(--border-radius-soft);
      transition: all 0.3s ease-in-out;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    nav a:hover, nav button:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    nav a.disabled {
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
      opacity: 0.7;
      transform: none;
      box-shadow: none;
    }

    /* Hero Section */
    .hero {
      background: url('https://placehold.co/1920x800/e0f7fa/3b5998?text=Aprendizaje+Inteligente') no-repeat center center/cover; /* Placeholder background image */
      padding: calc(6 * var(--spacing-unit)) var(--spacing-unit);
      text-align: center;
      color: var(--bg-white);
      box-shadow: 0 8px 30px var(--shadow-strong);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 550px; /* Altura m√≠nima para la secci√≥n hero */
    }
    .hero::before { /* Overlay for text readability */
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4); /* Oscurecer imagen */
      z-index: 1;
    }
    .hero h1 {
      font-size: 3.8em;
      margin-bottom: calc(1.5 * var(--spacing-unit));
      font-weight: 800;
      line-height: 1.2;
      max-width: 900px;
      position: relative;
      z-index: 2;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
    }
    .hero p {
      font-size: 1.6em;
      color: rgba(255, 255, 255, 0.9);
      max-width: 800px;
      margin: 0 auto;
      font-weight: 400;
      position: relative;
      z-index: 2;
      text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.4);
    }
    .hero .hero-buttons {
        margin-top: calc(2 * var(--spacing-unit));
        position: relative;
        z-index: 2;
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }
    .hero .hero-buttons button,
    .hero .hero-buttons a {
        background: var(--secondary-color);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: var(--border-radius-soft);
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        text-decoration: none;
        display: inline-block;
    }
    .hero .hero-buttons button:hover,
    .hero .hero-buttons a:hover {
        background: #40c4ff; /* Azul celeste m√°s vibrante */
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }


    /* Sections */
    .section {
      padding: calc(4 * var(--spacing-unit)) var(--spacing-unit);
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-white);
      border-radius: var(--border-radius-medium);
      margin-top: calc(2 * var(--spacing-unit));
      box-shadow: 0 6px 20px var(--shadow-medium);
      position: relative;
      overflow: hidden;
    }
    .section:first-of-type {
        margin-top: calc(3 * var(--spacing-unit)); /* Keep space from hero */
    }
    .section h2, .section h3 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: calc(2 * var(--spacing-unit));
      font-size: 2.8em;
      font-weight: 700;
      position: relative;
      padding-bottom: 10px;
    }
    .section h2::after, .section h3::after {
        content: '';
        display: block;
        width: 80px;
        height: 4px;
        background: var(--secondary-color);
        margin: 15px auto 0;
        border-radius: 2px;
    }
    .section p {
        font-size: 1.1em;
        margin-bottom: 1.5em;
        color: var(--text-dark);
        text-align: justify;
    }
    .section ul {
        list-style: none;
        padding-left: 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: calc(1.5 * var(--spacing-unit));
        margin-top: calc(2 * var(--spacing-unit));
    }
    .section ul li {
        background: linear-gradient(145deg, #e3f2fd, #e0f7fa);
        padding: var(--spacing-unit) calc(1.5 * var(--spacing-unit));
        border-radius: var(--border-radius-soft);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        font-size: 1.15em;
        color: var(--text-dark);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-left: 4px solid var(--primary-color);
    }
    .section ul li:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .section ul li img {
        height: 32px;
        width: 32px;
    }
    .section img {
      display: block;
      margin: calc(1.5 * var(--spacing-unit)) auto;
      border-radius: var(--border-radius-soft);
      box-shadow: 0 4px 15px var(--shadow-light);
    }
    .section .text-center {
        text-align: center;
    }

    /* Cards */
    .cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: calc(1.8 * var(--spacing-unit));
      margin-top: calc(2 * var(--spacing-unit));
    }
    .card {
      background: var(--bg-white);
      border-radius: var(--border-radius-medium);
      box-shadow: 0 8px 25px var(--shadow-medium);
      padding: calc(1.5 * var(--spacing-unit));
      width: 300px; /* Fixed width for consistency */
      text-align: center;
      transition: all 0.3s ease-in-out;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 280px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 35px var(--shadow-strong);
      border-color: var(--secondary-color);
    }
    .card img {
      width: 80px;
      height: 80px;
      margin-bottom: var(--spacing-unit);
      transition: transform 0.2s ease;
      filter: drop-shadow(0 3px 8px rgba(0,0,0,0.08));
    }
    .card:hover img {
        transform: scale(1.1);
    }
    .card h3 {
      font-size: 1.8em;
      color: var(--primary-color);
      margin-bottom: 12px;
      font-weight: 600;
    }
    .card p {
      font-size: 1em;
      color: var(--text-light);
      line-height: 1.5;
      flex-grow: 1;
    }
    .clickable-card {
      cursor: pointer;
    }
    .card-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(var(--primary-color), 0.9);
      color: var(--bg-white);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      font-weight: 600;
      font-size: 1.5em;
      border-radius: var(--border-radius-medium);
      padding: var(--spacing-unit);
      text-align: center;
    }
    .clickable-card:hover .card-overlay {
      opacity: 1;
    }

    /* Testimonials Section */
    .testimonial-card {
      background: var(--bg-white);
      border-radius: var(--border-radius-medium);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: calc(1.2 * var(--spacing-unit));
      text-align: center;
      max-width: 350px;
      margin: var(--spacing-unit);
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .testimonial-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }
    .testimonial-card img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-bottom: 15px;
      border: 2px solid var(--secondary-color);
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    }
    .testimonial-card h3 {
      color: var(--primary-color);
      font-size: 1.4em;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .testimonial-card p {
      font-style: italic;
      color: var(--text-dark);
      margin-bottom: 15px;
      flex-grow: 1;
      line-height: 1.5;
    }
    .testimonial-card .rating {
      color: var(--accent-color);
      font-size: 1.2em;
    }
    /* New: Review Section */
    #reviews-section {
        background: var(--bg-light);
        padding: calc(4 * var(--spacing-unit)) var(--spacing-unit);
        text-align: center;
        border-radius: var(--border-radius-medium);
        margin-top: calc(2 * var(--spacing-unit));
        box-shadow: 0 6px 20px var(--shadow-medium);
    }
    #reviews-section h2 {
        color: var(--primary-color);
        font-size: 2.8em;
        font-weight: 700;
        margin-bottom: calc(2 * var(--spacing-unit));
    }
    #reviews-section h2::after {
        background: var(--accent-color);
    }
    #reviews-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: calc(1.5 * var(--spacing-unit));
        max-width: 1200px;
        margin: 0 auto;
        padding-top: var(--spacing-unit);
    }
    .review-card {
        background: var(--bg-white);
        border-radius: var(--border-radius-medium);
        box-shadow: 0 6px 20px var(--shadow-light);
        padding: calc(1.5 * var(--spacing-unit));
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: all 0.3s ease;
        min-height: 200px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .review-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px var(--shadow-medium);
        border-color: var(--primary-color);
    }
    .review-card .reviewer-name {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 1.2em;
        margin-top: 10px;
        margin-bottom: 5px;
    }
    .review-card .review-text {
        font-size: 1em;
        color: var(--text-dark);
        font-style: italic;
        margin-bottom: 15px;
        flex-grow: 1;
        line-height: 1.5;
    }
    .review-card .review-rating {
        color: var(--accent-color);
        font-size: 1.1em;
        margin-top: 5px;
    }
    /* Review form styles */
    #submit-review-section .review-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 600px;
      margin: 30px auto;
      padding: calc(2 * var(--spacing-unit));
      background: var(--bg-white);
      border-radius: var(--border-radius-medium);
      box-shadow: 0 6px 20px var(--shadow-medium);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    #submit-review-section .review-form label {
        font-weight: 500;
        color: var(--text-dark);
        text-align: left;
        margin-bottom: 5px;
        font-size: 1.05em;
    }
    #submit-review-section .review-form textarea {
        width: calc(100% - 40px);
        padding: 15px 20px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius-soft);
        font-family: 'Poppins', sans-serif;
        font-size: 1em;
        min-height: 100px;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        resize: vertical;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    #submit-review-section .review-form textarea:focus {
        border-color: var(--primary-color);
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.1), 0 0 0 3px rgba(var(--primary-color), 0.15);
        outline: none;
    }
    #submit-review-section .review-form .rating-stars {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
    }
    #submit-review-section .review-form .rating-stars button {
        background: none;
        border: none;
        font-size: 2.8em;
        cursor: pointer;
        color: #d1d1d1;
        transition: color 0.2s ease, transform 0.1s ease;
    }
    #submit-review-section .review-form .rating-stars button:hover {
        transform: scale(1.1);
    }
    #submit-review-section .review-form .rating-stars button.selected {
        color: var(--accent-color);
        text-shadow: 0 0 5px rgba(255, 193, 7, 0.4);
    }
    #submit-review-section .review-form button[type="submit"] {
      background: var(--primary-color);
      color: white;
      padding: 14px 28px;
      border: none;
      border-radius: var(--border-radius-soft);
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease;
      margin-top: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    #submit-review-section .review-form button[type="submit"]:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
    .review-message {
      text-align: center;
      font-size: 1.05em;
      color: var(--text-dark);
      margin-top: 20px;
      padding: 15px;
      background: #eef5fb;
      border-radius: var(--border-radius-soft);
      border-left: 5px solid var(--secondary-color);
      font-weight: 500;
    }
    .review-submit-info {
        font-size: 0.95em;
        color: var(--text-light);
        margin-top: 15px;
    }

    /* Topic List specific styles */
    .topic-list {
        margin-top: calc(2 * var(--spacing-unit));
    }
    .topic-list h2 {
        font-size: 2.4em;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: calc(1.5 * var(--spacing-unit));
        text-align: center;
    }
    .topic-item {
        background: var(--bg-white);
        border-radius: var(--border-radius-soft);
        box-shadow: 0 4px 15px var(--shadow-light);
        padding: calc(1.2 * var(--spacing-unit));
        margin-bottom: var(--spacing-unit);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        transition: all 0.2s ease;
        cursor: pointer;
        border-left: 4px solid var(--primary-color);
    }
    .topic-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border-color: var(--secondary-color);
    }
    .topic-item .topic-title {
        font-size: 1.4em;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 8px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .topic-item .level-badge {
        background: var(--secondary-color);
        color: white;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 0.8em;
        font-weight: 500;
        margin-left: 15px;
        white-space: nowrap;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
    }
    .topic-item .progress-indicator {
        font-size: 0.9em;
        color: var(--text-light);
        font-weight: 400;
        margin-left: auto;
    }
    .topic-item .topic-description {
        font-size: 0.98em;
        color: var(--text-light);
        line-height: 1.4;
        text-align: left;
    }


    /* Contact Form */
    .contact-form {
      text-align: center;
      background: var(--bg-white);
      padding: calc(2 * var(--spacing-unit));
      border-radius: var(--border-radius-medium);
      box-shadow: 0 6px 20px var(--shadow-medium);
      max-width: 700px;
      margin: var(--spacing-unit) auto;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .contact-form p {
      font-size: 1.05em;
      margin-bottom: var(--spacing-unit);
      color: var(--text-dark);
    }
    .contact-form input,
    .contact-form textarea {
      width: calc(100% - 40px);
      padding: 14px 20px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: var(--border-radius-soft);
      font-size: 1em;
      color: var(--text-dark);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .contact-form input:focus,
    .contact-form textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(var(--primary-color), 0.15);
      outline: none;
    }
    .contact-form button {
      background: var(--primary-color);
      color: white;
      padding: 14px 28px;
      border: none;
      border-radius: var(--border-radius-soft);
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease;
      margin-top: var(--spacing-unit);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .contact-form button:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    /* Footer */
    footer {
      background: var(--text-dark); /* Fondo oscuro para el footer */
      color: white;
      text-align: center;
      padding: calc(2 * var(--spacing-unit)) var(--spacing-unit);
      margin-top: auto;
      font-size: 0.9em;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }
    footer .footer-links a {
        color: white;
        text-decoration: none;
        margin: 0 15px;
        font-weight: 400;
        transition: color 0.2s ease;
    }
    footer .footer-links a:hover {
        color: var(--secondary-color);
    }
    footer .payment-logos {
        margin-top: var(--spacing-unit);
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }
    footer .payment-logos img {
        height: 30px;
        filter: grayscale(100%) invert(100%); /* Make logos white for dark background */
        opacity: 0.8;
        transition: opacity 0.2s ease;
    }
    footer .payment-logos img:hover {
        opacity: 1;
    }
    footer .copyright {
        margin-top: var(--spacing-unit);
        font-size: 0.85em;
        color: rgba(255, 255, 255, 0.7);
    }

    /* Quiz Styles */
    #quiz-container {
      background: var(--bg-white);
      max-width: 650px;
      margin: calc(3 * var(--spacing-unit)) auto;
      padding: calc(2.5 * var(--spacing-unit));
      border-radius: var(--border-radius-medium);
      box-shadow: 0 8px 25px var(--shadow-medium);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    #quiz-container h2 {
      color: var(--primary-color);
      margin-bottom: calc(1.8 * var(--spacing-unit));
      text-align: center;
      font-size: 2.5em;
      font-weight: 700;
    }
    .question {
      margin-bottom: calc(1.5 * var(--spacing-unit));
      font-weight: 600;
      font-size: 1.3em;
      color: var(--text-dark);
      text-align: center;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .options button {
      width: 100%;
      padding: 14px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius-soft);
      cursor: pointer;
      font-size: 1.05em;
      font-weight: 500;
      transition: all 0.3s ease;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .options button:hover {
      background: var(--secondary-color);
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    /* Result Styles */
    #result-message {
      font-weight: 600;
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--primary-color);
      font-size: 1.5em;
      background: #e3f2fd;
      padding: 1.2 * var(--spacing-unit);
      border-radius: var(--border-radius-soft);
      border-left: 6px solid var(--secondary-color);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    /* ADHD Recommendations */
    #tdah-warning {
      margin-top: calc(2.5 * var(--spacing-unit));
      padding: 1.5rem;
      background-color: #fff8e1; /* Amarillo muy suave */
      border-radius: var(--border-radius-soft);
      color: #b35900;
      font-weight: 500;
      max-width: 750px;
      margin-left: auto;
      margin-right: auto;
      border-left: 6px solid var(--accent-color);
      font-size: 1.1em;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    #study-advice {
      max-width: 750px;
      margin: 0 auto calc(2 * var(--spacing-unit)) auto;
      font-weight: 500;
      color: var(--text-dark);
      padding: 1.5rem;
      background: #e8f5e9; /* Verde muy suave */
      border-radius: var(--border-radius-soft);
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-left: 6px solid var(--primary-color);
      font-size: 1.1em;
    }

    /* Progress Bar Styles */
    .progress-bar-container {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: var(--border-radius-soft);
      overflow: hidden;
      margin-bottom: calc(1.2 * var(--spacing-unit));
      height: 30px;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    .progress-bar-fill {
      height: 100%;
      background-color: var(--secondary-color);
      width: 0%;
      border-radius: var(--border-radius-soft) 0 0 var(--border-radius-soft);
      transition: width 0.5s ease-in-out;
    }
    .progress-text {
      position: absolute;
      width: 100%;
      text-align: center;
      line-height: 30px;
      color: var(--text-dark);
      font-weight: 500;
      font-size: 1em;
    }

    /* Lesson Content Display */
    #lesson-content-display {
        background: var(--bg-white);
        max-width: 900px;
        margin: calc(3 * var(--spacing-unit)) auto;
        padding: calc(2 * var(--spacing-unit));
        border-radius: var(--border-radius-medium);
        box-shadow: 0 10px 30px var(--shadow-medium);
        min-height: 500px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .back-button {
      background: none;
      border: none;
      color: var(--primary-color);
      font-size: 1.1em;
      font-weight: 500;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: var(--border-radius-soft);
      transition: all 0.2s ease;
      margin-bottom: var(--spacing-unit);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .back-button:hover {
      background: rgba(var(--primary-color), 0.1);
      transform: translateX(-3px);
    }
    #lesson-material h3 {
        color: var(--primary-color);
        font-size: 1.8em;
        margin-top: calc(1.5 * var(--spacing-unit));
        margin-bottom: var(--spacing-unit);
        font-weight: 600;
        border-bottom: 1px solid rgba(var(--primary-color), 0.1);
        padding-bottom: 5px;
    }
    #lesson-material p {
        font-size: 1.05em;
        margin-bottom: 1.4em;
        color: var(--text-dark);
        text-align: justify;
    }
    #lesson-material video,
    #lesson-material audio,
    #lesson-material img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: var(--spacing-unit) auto;
        border-radius: var(--border-radius-soft);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    #lesson-material textarea {
        width: calc(100% - 40px);
        padding: 15px 20px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius-soft);
        font-family: 'Poppins', sans-serif;
        font-size: 1em;
        min-height: 120px;
        margin-top: 15px;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        resize: vertical;
    }
    #lesson-material .interactive-game-placeholder {
        background-color: #e0f7fa;
        border: 2px dashed var(--secondary-color);
        padding: calc(2.5 * var(--spacing-unit));
        text-align: center;
        font-style: italic;
        color: var(--text-light);
        border-radius: var(--border-radius-soft);
        margin: calc(1.5 * var(--spacing-unit)) 0;
        font-size: 1.15em;
        font-weight: 400;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    #lesson-material button {
        background: var(--accent-color);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: var(--border-radius-soft);
        cursor: pointer;
        font-size: 1.05em;
        font-weight: 600;
        transition: background 0.3s ease, transform 0.2s ease;
        margin-top: calc(1.5 * var(--spacing-unit));
        box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
    }
    #lesson-material button:hover {
        background: #ffaa00;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(255, 193, 7, 0.4);
    }

    /* Custom Message Box */
    #custom-message {
        position: fixed;
        top: var(--spacing-unit);
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--primary-color);
        color: white;
        padding: 14px 28px;
        border-radius: var(--border-radius-soft);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        font-weight: 500;
    }
    #custom-message.show {
        opacity: 1;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1500;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-in-out;
    }
    .modal-overlay.active {
        opacity: 1;
        pointer-events: all;
    }

    /* Authentication Form Styles (within modal) */
    #auth-container {
      background: var(--bg-white);
      max-width: 450px;
      padding: calc(2 * var(--spacing-unit));
      border-radius: var(--border-radius-medium);
      box-shadow: 0 10px 30px var(--shadow-medium);
      text-align: center;
      position: relative;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    #auth-container h2 {
      color: var(--primary-color);
      margin-bottom: calc(1.5 * var(--spacing-unit));
      font-size: 2.2em;
      font-weight: 600;
    }
    #auth-container form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    #auth-container input[type="email"],
    #auth-container input[type="password"] {
      width: calc(100% - 40px);
      padding: 14px 20px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: var(--border-radius-soft);
      font-size: 1.05em;
      color: var(--text-dark);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    #auth-container input[type="email"]:focus,
    #auth-container input[type="password"]:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(var(--primary-color), 0.15);
      outline: none;
    }
    #auth-container button {
      background: var(--primary-color);
      color: white;
      padding: 14px 25px;
      border: none;
      border-radius: var(--border-radius-soft);
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease;
      margin-top: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    #auth-container button:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
    #auth-container .toggle-form-link {
        font-size: 0.95em;
        margin-top: var(--spacing-unit);
        color: var(--text-light);
        cursor: pointer;
        text-decoration: underline;
    }
    #auth-container .toggle-form-link:hover {
        color: var(--primary-color);
    }
    .close-modal-button {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 1.8em;
        color: var(--text-light);
        cursor: pointer;
        transition: color 0.2s ease, transform 0.2s ease;
    }
    .close-modal-button:hover {
        color: var(--primary-color);
        transform: rotate(90deg);
    }

    /* New Legal Sections */
    .legal-section {
        background: var(--bg-white);
        padding: calc(4 * var(--spacing-unit)) var(--spacing-unit);
        max-width: 900px;
        margin: calc(2 * var(--spacing-unit)) auto;
        border-radius: var(--border-radius-medium);
        box-shadow: 0 6px 20px var(--shadow-medium);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .legal-section h2 {
        font-size: 2.2em;
        color: var(--primary-color);
        margin-bottom: calc(1.5 * var(--spacing-unit));
        text-align: center;
        font-weight: 700;
    }
    .legal-section h3 {
        font-size: 1.6em;
        color: var(--secondary-color);
        margin-top: calc(1.5 * var(--spacing-unit));
        margin-bottom: calc(0.8 * var(--spacing-unit));
        font-weight: 600;
    }
    .legal-section p, .legal-section ul {
        font-size: 1em;
        color: var(--text-dark);
        line-height: 1.6;
        margin-bottom: 1em;
    }
    .legal-section ul {
        list-style: disc;
        padding-left: 25px;
    }
    .legal-section ol {
        list-style: decimal;
        padding-left: 25px;
    }
    .legal-section li {
        margin-bottom: 0.5em;
    }

    /* Responsive adjustments */
    @media (max-width: 900px) {
        .hero h1 {
            font-size: 3em;
        }
        .hero p {
            font-size: 1.4em;
        }
        .section h2, .section h3 {
            font-size: 2.4em;
        }
        .cards {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        .card {
            width: auto;
        }
    }

    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: center;
        padding: var(--spacing-unit);
      }
      header h1 {
        font-size: 2em;
      }
      header .logo-container img {
        height: 50px;
      }
      .hero {
          min-height: 400px;
          padding: calc(4 * var(--spacing-unit)) var(--spacing-unit);
      }
      .hero h1 {
        font-size: 2.5em;
      }
      .hero p {
        font-size: 1.2em;
      }
      .hero .hero-buttons {
          flex-direction: column;
          gap: 15px;
      }
      nav {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      nav a, nav button {
        font-size: 0.95em;
        padding: 6px 12px;
      }
      .section {
          padding: calc(2.5 * var(--spacing-unit)) var(--spacing-unit);
          margin-top: calc(1.5 * var(--spacing-unit));
      }
      .section h2, .section h3 {
        font-size: 2em;
      }
      .section p {
          text-align: left;
      }
      .cards, .testimonials-grid, #reviews-container {
        flex-direction: column;
        align-items: center;
      }
      .card, .testimonial-card, .review-card {
        width: 90%;
        max-width: 350px;
      }
      .contact-form input,
      .contact-form textarea {
        width: calc(100% - 30px);
        padding: 12px 15px;
      }
      #quiz-container, #lesson-content-display, #auth-container, .legal-section {
        margin: calc(1.5 * var(--spacing-unit)) auto;
        padding: calc(1.5 * var(--spacing-unit));
      }
      #quiz-container h2 {
          font-size: 2.2em;
      }
      .question {
        font-size: 1.15em;
      }
      .options button {
            font-size: 0.95em;
            padding: 12px;
      }
      footer .footer-links a {
          margin: 0 10px;
      }
    }
    @media (max-width: 480px) {
        header h1 {
            font-size: 1.8em;
        }
        .hero h1 {
            font-size: 2em;
        }
        .hero p {
            font-size: 1em;
        }
        .hero .hero-buttons {
            gap: 10px;
        }
        .hero .hero-buttons button,
        .hero .hero-buttons a {
            padding: 12px 25px;
            font-size: 1em;
        }
        .section h2, .section h3 {
            font-size: 1.8em;
        }
        .card {
            padding: var(--spacing-unit);
            min-height: 250px;
        }
        .card h3 {
            font-size: 1.6em;
        }
        .options button {
            font-size: 0.9em;
            padding: 10px;
        }
        #quiz-container h2 {
            font-size: 1.8em;
        }
        .question {
            font-size: 1em;
        }
        #result-message, #tdah-warning, #study-advice {
            font-size: 0.95em;
            padding: var(--spacing-unit);
        }
        .topic-item .topic-title {
            font-size: 1.2em;
        }
        .topic-item .topic-description {
            font-size: 0.85em;
        }
        .legal-section h2 {
            font-size: 2em;
        }
        .legal-section h3 {
            font-size: 1.4em;
        }
        .legal-section p, .legal-section ul, .legal-section ol {
            font-size: 0.9em;
        }
    }
  </style>
</head>
<body>

  <!-- Custom Message Box -->
  <div id="custom-message"></div>

  <!-- Authentication Modal -->
  <div id="auth-modal-overlay" class="modal-overlay">
    <div id="auth-container">
      <button class="close-modal-button" aria-label="Cerrar modal" onclick="window.hideAuthModal()">&times;</button>
      <div id="login-form">
        <h2>Iniciar Sesi√≥n</h2>
        <form id="login-email-form" aria-labelledby="login-heading">
          <input type="email" id="login-email" placeholder="Correo Electr√≥nico" required autocomplete="email" aria-label="Correo electr√≥nico" />
          <input type="password" id="login-password" placeholder="Contrase√±a" required autocomplete="current-password" aria-label="Contrase√±a" />
          <button type="submit">Iniciar Sesi√≥n</button>
        </form>
        <p class="toggle-form-link" role="button" tabindex="0" onclick="window.toggleAuthForm('register')" onkeypress="if(event.key === 'Enter') window.toggleAuthForm('register')">¬øNo tienes cuenta? Reg√≠strate</p>
      </div>

      <div id="register-form" style="display: none;">
        <h2>Registrarse</h2>
        <form id="register-email-form" aria-labelledby="register-heading">
          <input type="email" id="register-email" placeholder="Correo Electr√≥nico" required autocomplete="email" aria-label="Correo electr√≥nico" />
          <input type="password" id="register-password" placeholder="Contrase√±a" required autocomplete="new-password" aria-label="Contrase√±a" />
          <button type="submit">Registrarse</button>
        </form>
        <p class="toggle-form-link" role="button" tabindex="0" onclick="window.toggleAuthForm('login')" onkeypress="if(event.key === 'Enter') window.toggleAuthForm('login')">¬øYa tienes cuenta? Inicia Sesi√≥n</p>
      </div>
    </div>
  </div>


  <div id="quiz-container" style="display: none;" role="main" aria-labelledby="quiz-heading">
    <h2 id="quiz-heading">Cuestionario de Estilo de Aprendizaje</h2>
    <div id="question-text" class="question"></div>
    <div id="options" class="options"></div>
  </div>

  <div id="main-content" role="main">
    <header>
      <div class="logo-container">
        <img src="Blue Modern Brain Genius And Technology Smart Mind Business Logo Template.png-621ecb34-e983-4691-968f-9f0a33cae13c" alt="Logo de MultiGenio, cerebro con dos hemisferios" />
        <div>
            <h1>MultiGenio</h1>
            <p>Tu aliado en el aprendizaje</p>
        </div>
      </div>
      <div id="user-id-display" style="display: none;" aria-live="polite"></div>
    </header>

    <nav aria-label="Navegaci√≥n principal">
      <a href="#que-es">¬øQu√© es?</a>
      <a href="#materias">Materias</a>
      <a href="#beneficios">Beneficios</a>
      <a href="#testimonios">Testimonios</a>
      <a href="#contacto">Contacto</a>
      <a href="#" id="auth-nav-link" onclick="window.showAuthModal()">Iniciar Sesi√≥n / Registrarse</a>
      <button id="guest-mode-button" aria-label="Entrar en modo invitado">Modo Invitado</button>
      <a href="#" id="quiz-nav-link" onclick="window.showQuestion()">Cuestionario</a>
      <button id="logout-button" aria-label="Cerrar sesi√≥n">Cerrar Sesi√≥n</button>
    </nav>

    <section class="hero" aria-label="Secci√≥n principal de bienvenida">
      <h1>Tu tutor virtual inteligente para Matem√°ticas, Ingl√©s y Lengua</h1>
      <p>Un m√©todo de aprendizaje din√°mico, adaptado a tu ritmo y estilo, dise√±ado para potenciar tu concentraci√≥n y comprensi√≥n.</p>
      <div class="hero-buttons">
          <a href="#materias">Explorar Materias</a>
          <button onclick="window.showQuestion()">Haz el Cuestionario</button>
      </div>
    </section>

    <div id="result-message" role="status" aria-live="polite" style="display: none;"></div>
    <div id="study-advice" role="note" style="display: none;"></div>
    <div id="tdah-warning" role="alert" style="display: none;">
      ‚ö†Ô∏è Si presentas indicios de TDAH, MultiGenio te ofrecer√° recursos y estrategias especiales para ayudarte a mantener la concentraci√≥n y aprovechar tu estilo de aprendizaje de la forma m√°s efectiva.
    </div>

    <section class="section" id="que-es" aria-labelledby="que-es-heading">
      <h2 id="que-es-heading">¬øQu√© es MultiGenio?</h2>
      <img src="https://placehold.co/100x100/eef5fb/3b5998?text=IA" alt="Icono de inteligencia artificial" />
      <p>
        <strong>MultiGenio</strong> es una innovadora plataforma educativa dise√±ada para transformar la experiencia de aprendizaje. Nos especializamos en ofrecer un **tutor virtual inteligente** que se adapta de manera din√°mica a las necesidades individuales de cada estudiante, maximizando su potencial en materias clave como **Matem√°ticas, Ingl√©s y Lengua Espa√±ola**. Nuestra misi√≥n es hacer el aprendizaje accesible, efectivo y estimulante para todos, incluyendo aquellos con **TDAH** o dificultades de atenci√≥n, proporcionando herramientas y estrategias personalizadas que fomentan la concentraci√≥n y la comprensi√≥n profunda.
      </p>

      <h3>üß† La Inteligencia Artificial en Acci√≥n: Un Enfoque Adaptativo y Personalizado</h3>
      <img src="https://placehold.co/100x100/eef5fb/3b5998?text=Adaptaci√≥n" alt="Icono de adaptaci√≥n" />
      <p>
        En el coraz√≥n de MultiGenio reside una **Inteligencia Artificial avanzada** que va m√°s all√° de los m√©todos tradicionales. Nuestra IA analiza un conjunto de datos clave: desde tus respuestas en el cuestionario inicial, el progreso en los juegos interactivos, el tiempo que dedicas a cada tema, hasta tus preferencias de material did√°ctico (visual, auditivo, de lectura/escritura, kinest√©sico). Con esta informaci√≥n, el sistema es capaz de **ajustar din√°micamente la dificultad de los ejercicios, priorizar tipos de contenido espec√≠ficos y sugerir rutas de aprendizaje alternativas** que se alinean perfectamente con tu estilo.
      </p>
      <p>
        Por ejemplo, si la IA detecta que un estudiante visual tiene dificultades con un concepto particular, podr√≠a ofrecer un **video explicativo animado**, un **mapa mental interactivo** o diagramas claros antes de proponer ejercicios de texto. Para alumnos con TDAH, la plataforma puede fragmentar lecciones extensas en **m√≥dulos m√°s cortos y manejables**, incorporar **micro-descansos activos** con ejercicios de concentraci√≥n, o activar **alertas visuales/auditivas sutiles** para ayudar a mantener el enfoque. Este enfoque garantiza una experiencia educativa que se siente hecha a la medida, minimizando las distracciones y potenciando al m√°ximo la concentraci√≥n y el disfrute del aprendizaje.
      </p>

      <h2>üìã Cuestionario Inicial: Tu Huella de Aprendizaje para una Personalizaci√≥n √ìptima</h2>
      <img src="https://placehold.co/100x100/eef5fb/3b5998?text=Quiz" alt="Icono de cuestionario" />
      <p>
        Antes de iniciar tu viaje con MultiGenio, te invitamos a completar un **cuestionario interactivo y estrat√©gico**. Este no es un simple test de conocimientos; es una herramienta fundamental para que nuestra IA comprenda tu perfil de aprendizaje √∫nico. Las preguntas est√°n meticulosamente dise√±adas para identificar tu estilo de aprendizaje predominante y posibles indicios relacionados con el **Trastorno por D√©ficit de Atenci√≥n e Hiperactividad (TDAH)**. Este perfil inicial es la base sobre la cual nuestra IA construye y personaliza cada faceta de tu trayectoria de aprendizaje en MultiGenio, garantizando una experiencia √≥ptima y libre de frustraciones.
      </p>
    </section>
   
    <section class="section" id="materias" aria-labelledby="materias-heading">
      <h2 id="materias-heading">Explora Nuestras Materias</h2>
      <p class="text-center">En MultiGenio, ofrecemos un curr√≠culo completo y adaptado para que domines las asignaturas m√°s importantes.</p>
      <div class="cards">
        <div class="card clickable-card" role="button" tabindex="0" onclick="window.showSubject('matematicas')" onkeypress="if(event.key === 'Enter') window.showSubject('matematicas')">
          <img src="https://placehold.co/90x90/eef5fb/3b5998?text=MATH" alt="Icono de calculadora para Matem√°ticas" />
          <h3>Matem√°ticas</h3>
          <p>Desde los fundamentos de aritm√©tica hasta el √°lgebra avanzada para secundaria. Aprende con juegos mentales, visualizaciones interactivas y l√≥gica adaptada a tu ritmo de aprendizaje.</p>
          <div class="card-overlay">
            <span>¬°Acceder!</span>
          </div>
        </div>
        <div class="card clickable-card" role="button" tabindex="0" onclick="window.showSubject('lengua')" onkeypress="if(event.key === 'Enter') window.showSubject('lengua')">
          <img src="https://placehold.co/90x90/eef5fb/3b5998?text=LENG" alt="Icono de libro para Lengua" />
          <h3>Lengua</h3>
          <p>Domina la morfolog√≠a, sintaxis, ortograf√≠a y redacci√≥n con ejemplos pr√°cticos, ejercicios creativos y explicaciones que facilitan la memorizaci√≥n y comprensi√≥n profunda.</p>
          <div class="card-overlay">
            <span>¬°Acceder!</span>
          </div>
        </div>
        <div class="card clickable-card" role="button" tabindex="0" onclick="window.showSubject('ingles')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'basic-vocabulary')">
          <img src="https://placehold.co/90x90/eef5fb/3b5998?text=ENG" alt="Icono de bandera de Reino Unido para Ingl√©s" />
          <h3>Ingl√©s</h3>
          <p>Desde el nivel b√°sico A1 hasta el intermedio B1: expande tu vocabulario, perfecciona tu gram√°tica, mejora tu comprensi√≥n auditiva y fluidez oral con contenido visual y audios interactivos.</p>
          <div class="card-overlay">
            <span>¬°Acceder!</span>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="beneficios" aria-labelledby="beneficios-heading">
      <h2 id="beneficios-heading">¬øPor qu√© elegir MultiGenio?</h2>
      <p class="text-center">Descubre las ventajas que te ofrece nuestra plataforma para un aprendizaje verdaderamente efectivo y motivador.</p>
      <ul>
        <li><img src="https://img.icons8.com/color/48/star--v1.png" alt="Icono de estrella"/> Explicaciones adaptadas a estudiantes con TDA/TDAH y dificultades de atenci√≥n.</li>
        <li><img src="https://img.icons8.com/color/48/video-camera.png" alt="Icono de c√°mara de video"/> Contenido multimedia enriquecido: videos, ejemplos claros y material creativo.</li>
        <li><img src="https://img.icons8.com/color/48/brain.png" alt="Icono de cerebro"/> Aprendizaje 100% personalizado, a tu propio ritmo y sin presiones.</li>
        <li><img src="https://img.icons8.com/color/48/graduation-cap.png" alt="Icono de gorro de graduaci√≥n"/> Una herramienta ideal para el apoyo educativo en casa, para padres, docentes y alumnos.</li>
      </ul>
    </section>

    <section class="section" id="testimonios" aria-labelledby="testimonios-heading">
      <h2 id="testimonios-heading">Lo que dicen nuestros alumnos y familias</h2>
      <p class="text-center">Las experiencias reales de quienes ya est√°n transformando su aprendizaje con MultiGenio.</p>
      <div class="cards testimonials-grid">
        <div class="card testimonial-card">
          <img src="https://placehold.co/70x70/4CAF50/ffffff?text=LG" alt="Foto de perfil de Laura G." />
          <h3>Laura G.</h3>
          <p>"¬°MultiGenio cambi√≥ por completo mi forma de ver las matem√°ticas! Siempre me frustraba, pero con sus explicaciones visuales y los juegos interactivos, ahora entiendo los conceptos m√°s complejos de una forma mucho m√°s sencilla y divertida. ¬°Lo recomiendo a todos mis compa√±eros!"</p>
          <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        <div class="card testimonial-card">
          <img src="https://placehold.co/70x70/4CAF50/ffffff?text=PR" alt="Foto de perfil de Pablo R." />
          <h3>Pablo R. (Padre)</h3>
          <p>"Como padre de un ni√±o con TDAH, encontrar MultiGenio ha sido una verdadera bendici√≥n. La paciencia, el enfoque adaptado y las herramientas espec√≠ficas que ofrece la plataforma son incre√≠bles. Mi hijo est√° m√°s motivado que nunca y aprendiendo sin el estr√©s de antes. ¬°Estamos encantados!"</p>
          <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        <div class="card testimonial-card">
          <img src="https://placehold.co/70x70/4CAF50/ffffff?text=SM" alt="Foto de perfil de Sof√≠a M." />
          <h3>Sof√≠a M. (Profesora)</h3>
          <p>"He tenido la oportunidad de probar muchas herramientas educativas, pero MultiGenio es √∫nica por su profunda capacidad de adaptaci√≥n. La Inteligencia Artificial es una maravilla para detectar y apoyar a cada alumno seg√∫n su estilo de aprendizaje y necesidades. La recomiendo sin dudarlo a todos mis colegas y sus estudiantes."</p>
          <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
      </div>
    </section>

    <section id="reviews-section" class="section" aria-labelledby="reviews-heading">
        <h2 id="reviews-heading">Opiniones de Nuestros Usuarios</h2>
        <div id="reviews-container">
            <!-- Las rese√±as se cargar√°n aqu√≠ din√°micamente desde Firestore -->
        </div>
        <div id="review-submit-area">
            <h3 style="color: var(--primary-color); margin-top: 40px; font-size: 2em; font-weight: 600;">Deja tu Rese√±a</h3>
            <p class="review-submit-info" id="review-auth-message">Inicia sesi√≥n para poder dejar una rese√±a.</p>
            <form id="review-form" class="review-form" style="display: none;" aria-labelledby="review-form-heading">
                <label for="review-text">Tu Experiencia:</label>
                <textarea id="review-text" placeholder="Comparte tu opini√≥n sobre MultiGenio..." rows="5" required aria-label="Tu rese√±a"></textarea>
                
                <label for="review-rating">Tu Calificaci√≥n:</label>
                <div id="review-rating-stars" class="rating-stars" aria-label="Calificaci√≥n de 1 a 5 estrellas">
                    <button type="button" data-rating="1" aria-label="1 estrella">‚≠ê</button>
                    <button type="button" data-rating="2" aria-label="2 estrellas">‚≠ê</button>
                    <button type="button" data-rating="3" aria-label="3 estrellas">‚≠ê</button>
                    <button type="button" data-rating="4" aria-label="4 estrellas">‚≠ê</button>
                    <button type="button" data-rating="5" aria-label="5 estrellas">‚≠ê</button>
                </div>
                <input type="hidden" id="selected-rating" value="0" />
                
                <button type="submit">Enviar Rese√±a</button>
            </form>
        </div>
    </section>


    <section class="section" id="contacto" aria-labelledby="contacto-heading">
      <h2 id="contacto-heading">Contacta con Nosotros</h2>
      <div class="contact-form">
        <p>¬øQuieres probar MultiGenio o tienes dudas? Env√≠anos un mensaje y te responderemos a la brevedad posible.</p>
        <form>
          <input type="text" placeholder="Tu nombre" required aria-label="Tu nombre" /><br />
          <input type="email" placeholder="Tu correo electr√≥nico" required aria-label="Tu correo electr√≥nico" /><br />
          <textarea placeholder="Tu mensaje..." rows="5" required aria-label="Tu mensaje"></textarea><br />
          <button type="submit">Enviar mensaje</button>
        </form>
      </div>
    </section>

    <script>
      // Configuraci√≥n para el chatbot de Chatbase
      window.chatbaseConfig = {
        chatbotId: "frw3UKvg6MK3c9Zw-bZAu"
      };
    </script>
    <script src="https://www.chatbase.co/embed.min.js" defer></script>

    <footer>
      <div class="footer-links">
          <a href="#terminos">T√©rminos y Condiciones</a>
          <a href="#politicas">Pol√≠tica de Privacidad</a>
          <a href="#contacto">Contacto</a>
      </div>
      <div class="payment-logos">
          <img src="https://www.svgrepo.com/show/303108/visa-logo.svg" alt="Logo de Visa" />
          <img src="https://www.svgrepo.com/show/303109/mastercard-logo.svg" alt="Logo de Mastercard" />
          <img src="https://www.svgrepo.com/show/303117/paypal-logo.svg" alt="Logo de PayPal" />
          <img src="https://www.svgrepo.com/show/303119/stripe-logo.svg" alt="Logo de Stripe" />
      </div>
      <p class="copyright">&copy; 2025 MultiGenio. Todos los derechos reservados.</p>
    </footer>
  </div>

  <div id="matematicas-page" class="subject-page section" style="display: none;" role="main" aria-labelledby="matematicas-heading">
    <button class="back-button" onclick="window.showMainContent()" aria-label="Volver al inicio">‚Üê Volver al inicio</button>
    <h1 id="matematicas-heading" style="text-align: center; color: var(--primary-color);">üìä Matem√°ticas</h1>
    <div id="math-personalized-intro" aria-live="polite"></div>

    <div class="progress-bar-container" id="matematicas-progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progreso en Matem√°ticas">
      <div class="progress-bar-fill" id="matematicas-progress-fill" style="width: 0%;"></div>
      <span class="progress-text" id="matematicas-progress-text">0% completado</span>
    </div>
    
    <div class="topic-list" aria-label="Temario de Matem√°ticas">
      <h2>Temario por niveles</h2>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('matematicas', 'operaciones-basicas')" onkeypress="if(event.key === 'Enter') window.showLessonContent('matematicas', 'operaciones-basicas')">
        <div class="topic-title">Operaciones B√°sicas <span class="level-badge">Primaria</span>
          <span class="progress-indicator" id="progress-matematicas-operaciones-basicas"></span>
        </div>
        <div class="topic-description">Suma, resta, multiplicaci√≥n y divisi√≥n. Problemas pr√°cticos del d√≠a a d√≠a.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('matematicas', 'fracciones')" onkeypress="if(event.key === 'Enter') window.showLessonContent('matematicas', 'fracciones')">
        <div class="topic-title">Fracciones y Decimales <span class="level-badge">6¬∫ Primaria</span>
          <span class="progress-indicator" id="progress-matematicas-fracciones"></span>
        </div>
        <div class="topic-description">Conceptos, operaciones y equivalencias. Con ejemplos visuales.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('matematicas', 'porcentajes')" onkeypress="if(event.key === 'Enter') window.showLessonContent('matematicas', 'porcentajes')">
        <div class="topic-title">Porcentajes <span class="level-badge">1¬∫ ESO</span>
          <span class="progress-indicator" id="progress-matematicas-porcentajes"></span>
        </div>
        <div class="topic-description">C√°lculo de porcentajes, aumentos y descuentos.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('matematicas', 'ecuaciones')" onkeypress="if(event.key === 'Enter') window.showLessonContent('matematicas', 'ecuaciones')">
        <div class="topic-title">Ecuaciones de Primer Grado <span class="level-badge">2¬∫ ESO</span>
          <span class="progress-indicator" id="progress-matematicas-ecuaciones"></span>
        </div>
        <div class="topic-description">Resoluci√≥n paso a paso con m√©todos visuales.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('matematicas', 'sistemas')" onkeypress="if(event.key === 'Enter') window.showLessonContent('matematicas', 'sistemas')">
        <div class="topic-title">Sistemas de Ecuaciones <span class="level-badge">3¬∫ ESO</span>
          <span class="progress-indicator" id="progress-matematicas-sistemas"></span>
        </div>
        <div class="topic-description">M√©todos de sustituci√≥n, igualaci√≥n y reducci√≥n.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('matematicas', 'geometria')" onkeypress="if(event.key === 'Enter') window.showLessonContent('matematicas', 'geometria')">
        <div class="topic-title">Geometr√≠a B√°sica <span class="level-badge">1¬∫-2¬∫ ESO</span>
          <span class="progress-indicator" id="progress-matematicas-geometria"></span>
        </div>
        <div class="topic-description">√Åreas, per√≠metros y vol√∫menes de figuras b√°sicas.</div>
      </div>
    </div>
  </div>

  <div id="lengua-page" class="subject-page section" style="display: none;" role="main" aria-labelledby="lengua-heading">
    <button class="back-button" onclick="window.showMainContent()" aria-label="Volver al inicio">‚Üê Volver al inicio</button>
    <h1 id="lengua-heading" style="text-align: center; color: var(--primary-color);">üìö Lengua Espa√±ola</h1>
    <div id="lengua-personalized-intro" aria-live="polite"></div>

    <div class="progress-bar-container" id="lengua-progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progreso en Lengua Espa√±ola">
      <div class="progress-bar-fill" id="lengua-progress-fill" style="width: 0%;"></div>
      <span class="progress-text" id="lengua-progress-text">0% completado</span>
    </div>
    
    <div class="topic-list" aria-label="Temario de Lengua Espa√±ola">
      <h2>Temario por niveles</h2>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('lengua', 'ortografia-basica')" onkeypress="if(event.key === 'Enter') window.showLessonContent('lengua', 'ortografia-basica')">
        <div class="topic-title">Ortograf√≠a B√°sica <span class="level-badge">Primaria</span>
          <span class="progress-indicator" id="progress-lengua-ortografia-basica"></span>
        </div>
        <div class="topic-description">Acentuaci√≥n, uso de b/v, g/j, h. Con ejercicios pr√°cticos.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('lengua', 'morfologia')" onkeypress="if(event.key === 'Enter') window.showLessonContent('lengua', 'morfologia')">
        <div class="topic-title">Morfolog√≠a <span class="level-badge">1¬∫ ESO</span>
          <span class="progress-indicator" id="progress-lengua-morfologia"></span>
        </div>
        <div class="topic-description">Categor√≠as gramaticales: sustantivos, adjetivos, verbos, etc.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('lengua', 'sintaxis-simple')" onkeypress="if(event.key === 'Enter') window.showLessonContent('lengua', 'sintaxis-simple')">
        <div class="topic-title">Sintaxis - Oraci√≥n Simple <span class="level-badge">2¬∫ ESO</span>
          <span class="progress-indicator" id="progress-lengua-sintaxis-simple"></span>
        </div>
        <div class="topic-description">Sujeto, predicado y complementos b√°sicos.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('lengua', 'sintaxis-compuesta')" onkeypress="if(event.key === 'Enter') window.showLessonContent('lengua', 'sintaxis-compuesta')">
        <div class="topic-title">Sintaxis - Oraci√≥n Compuesta <span class="level-badge">3¬∫ ESO</span>
          <span class="progress-indicator" id="progress-lengua-sintaxis-compuesta"></span>
        </div>
        <div class="topic-description">Oraciones coordinadas y subordinadas.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('lengua', 'literatura')" onkeypress="if(event.key === 'Enter') window.showLessonContent('lengua', 'literatura')">
        <div class="topic-title">Literatura Espa√±ola <span class="level-badge">2¬∫-3¬∫ ESO</span>
          <span class="progress-indicator" id="progress-lengua-literatura"></span>
        </div>
        <div class="topic-description">G√©neros literarios, m√©trica y autores principales.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('lengua', 'expresion-escrita')" onkeypress="if(event.key === 'Enter') window.showLessonContent('lengua', 'expresion-escrita')">
        <div class="topic-title">Expresi√≥n Escrita <span class="level-badge">Todos</span>
          <span class="progress-indicator" id="progress-lengua-expresion-escrita"></span>
        </div>
        <div class="topic-description">T√©cnicas de redacci√≥n, tipos de texto y coherencia.</div>
      </div>
    </div>
  </div>

  <div id="ingles-page" class="subject-page section" style="display: none;" role="main" aria-labelledby="ingles-heading">
    <button class="back-button" onclick="window.showMainContent()" aria-label="Volver al inicio">‚Üê Volver al inicio</button>
    <h1 id="ingles-heading" style="text-align: center; color: var(--primary-color);">üá¨üáß English</h1>
    <div id="ingles-personalized-intro" aria-live="polite"></div>

    <div class="progress-bar-container" id="ingles-progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progreso en Ingl√©s">
      <div class="progress-bar-fill" id="ingles-progress-fill" style="width: 0%;"></div>
      <span class="progress-text" id="ingles-progress-text">0% completado</span>
    </div>
    
    <div class="topic-list" aria-label="Temario de Ingl√©s">
      <h2>Temario por niveles</h2>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('ingles', 'basic-vocabulary')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'basic-vocabulary')">
        <div class="topic-title">Basic Vocabulary <span class="level-badge">A1</span>
          <span class="progress-indicator" id="progress-ingles-basic-vocabulary"></span>
        </div>
        <div class="topic-description">Numbers, colors, family, daily routines. Con apoyo visual.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('ingles', 'present-tenses')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'present-tenses')">
        <div class="topic-title">Present Simple & Continuous <span class="level-badge">A1-A2</span>
          <span class="progress-indicator" id="progress-ingles-present-tenses"></span>
        </div>
        <div class="topic-description">Tiempos verbales b√°sicos con ejemplos pr√°cticos.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('ingles', 'past-tenses')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'past-tenses')">
        <div class="topic-title">Past Simple & Past Continuous <span class="level-badge">A2</span>
          <span class="progress-indicator" id="progress-ingles-past-tenses"></span>
        </div>
        <div class="topic-description">Narraci√≥n en pasado, verbos regulares e irregulares.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('ingles', 'future-tenses')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'future-tenses')">
        <div class="topic-title">Future Tenses <span class="level-badge">A2-B1</span>
          <span class="progress-indicator" id="progress-ingles-future-tenses"></span>
        </div>
        <div class="topic-description">Will, going to, present continuous for future.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('ingles', 'conditionals')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'conditionals')">
        <div class="topic-title">Conditionals <span class="level-badge">B1</span>
          <span class="progress-indicator" id="progress-ingles-conditionals"></span>
        </div>
        <div class="topic-description">First, second and third conditional sentences.</div>
      </div>
      
      <div class="topic-item" role="button" tabindex="0" onclick="window.showLessonContent('ingles', 'listening-speaking')" onkeypress="if(event.key === 'Enter') window.showLessonContent('ingles', 'listening-speaking')">
        <div class="topic-title">Listening & Speaking <span class="level-badge">A1-B1</span>
          <span class="progress-indicator" id="progress-ingles-listening-speaking"></span>
        </div>
        <div class="topic-description">Ejercicios de comprensi√≥n auditiva y pronunciaci√≥n.</div>
      </div>
    </div>
  </div>

  <div id="lesson-content-display" class="section" style="display: none;" role="main" aria-labelledby="lesson-title">
    <button class="back-button" onclick="window.hideLessonContent()" aria-label="Volver al temario">‚Üê Volver al temario</button>
    <h2 id="lesson-title"></h2>
    <div id="lesson-material"></div>
  </diV>

  <!-- T√©rminos y Condiciones -->
  <div id="terminos-page" class="legal-section" style="display: none;" role="main" aria-labelledby="terminos-heading">
    <button class="back-button" onclick="window.showMainContent()">‚Üê Volver al inicio</button>
    <h2 id="terminos-heading">T√©rminos y Condiciones</h2>
    <p>√öltima actualizaci√≥n: 11 de junio de 2025</p>

    <h3>1. Introducci√≥n</h3>
    <p>
      Bienvenido a MultiGenio. Al acceder o utilizar nuestra plataforma, aceptas estar sujeto a estos T√©rminos y Condiciones. Si no est√°s de acuerdo con alguna parte de los t√©rminos, no podr√°s acceder a la plataforma.
    </p>

    <h3>2. Uso de la Plataforma</h3>
    <ul>
      <li>MultiGenio es una plataforma educativa para el aprendizaje en l√≠nea.</li>
      <li>El contenido proporcionado es solo para fines educativos.</li>
      <li>Est√° prohibido cualquier uso ilegal o no autorizado de la plataforma.</li>
    </ul>

    <h3>3. Cuentas de Usuario</h3>
    <p>
      Eres responsable de mantener la confidencialidad de tu cuenta y contrase√±a y de restringir el acceso a tu computadora. Aceptas la responsabilidad de todas las actividades que ocurran bajo tu cuenta o contrase√±a.
    </p>

    <h3>4. Propiedad Intelectual</h3>
    <p>
      Todo el contenido, caracter√≠sticas y funcionalidades originales de MultiGenio (incluyendo textos, gr√°ficos, logotipos, iconos, im√°genes y software) son propiedad exclusiva de MultiGenio y est√°n protegidos por leyes de derechos de autor internacionales.
    </p>

    <h3>5. Limitaci√≥n de Responsabilidad</h3>
    <p>
      MultiGenio no garantiza que la plataforma est√© libre de errores o que el acceso ser√° ininterrumpido. En ning√∫n caso MultiGenio ser√° responsable de da√±os directos, indirectos, incidentales, consecuentes o especiales que surjan del uso o la imposibilidad de usar la plataforma.
    </p>

    <h3>6. Enlaces a Otros Sitios Web</h3>
    <p>
      Nuestra plataforma puede contener enlaces a sitios web o servicios de terceros que no son propiedad ni est√°n controlados por MultiGenio. No tenemos control ni asumimos responsabilidad por el contenido, las pol√≠ticas de privacidad o las pr√°cticas de ning√∫n sitio web o servicio de terceros.
    </p>

    <h3>7. Modificaciones</h3>
    <p>
      Nos reservamos el derecho, a nuestra entera discreci√≥n, de modificar o reemplazar estos T√©rminos en cualquier momento. Si una revisi√≥n es material, intentaremos proporcionar un aviso de al menos 30 d√≠as antes de que los nuevos t√©rminos entren en vigencia. Lo que constituye un cambio material se determinar√° a nuestra entera discreci√≥n.
    </p>

    <h3>8. Ley Aplicable</h3>
    <p>
      Estos T√©rminos se regir√°n e interpretar√°n de acuerdo con las leyes de Espa√±a, sin tener en cuenta sus disposiciones sobre conflicto de leyes.
    </p>

    <h3>9. Contacto</h3>
    <p>
      Si tienes alguna pregunta sobre estos T√©rminos, por favor cont√°ctanos a trav√©s de la secci√≥n de Contacto.
    </p>
  </div>

  <!-- Pol√≠tica de Privacidad -->
  <div id="politicas-page" class="legal-section" style="display: none;" role="main" aria-labelledby="politicas-heading">
    <button class="back-button" onclick="window.showMainContent()">‚Üê Volver al inicio</button>
    <h2 id="politicas-heading">Pol√≠tica de Privacidad</h2>
    <p>√öltima actualizaci√≥n: 11 de junio de 2025</p>

    <h3>1. Recopilaci√≥n de Informaci√≥n</h3>
    <p>
      Recopilamos informaci√≥n personal que nos proporcionas directamente al registrarte en MultiGenio, como tu nombre, direcci√≥n de correo electr√≥nico y contrase√±a. Tambi√©n recopilamos datos de uso, como el progreso en las lecciones, las respuestas del cuestionario de estilo de aprendizaje y las interacciones con la plataforma.
    </p>

    <h3>2. Uso de la Informaci√≥n</h3>
    <p>
      Utilizamos la informaci√≥n recopilada para:
    </p>
    <ul>
      <li>Personalizar tu experiencia de aprendizaje.</li>
      <li>Gestionar tu cuenta y proporcionarte acceso a nuestros servicios.</li>
      <li>Mejorar y desarrollar nuevas funcionalidades para MultiGenio.</li>
      <li>Comunicarnos contigo sobre actualizaciones y ofertas relevantes.</li>
      <li>Analizar patrones de uso para optimizar la plataforma.</li>
    </ul>

    <h3>3. Compartir Informaci√≥n</h3>
    <p>
      No vendemos, intercambiamos ni transferimos de ninguna otra forma a terceros tu informaci√≥n de identificaci√≥n personal. Esto no incluye a los terceros de confianza que nos asisten en la operaci√≥n de nuestra plataforma, siempre y cuando dichas partes acuerden mantener esta informaci√≥n confidencial.
    </p>

    <h3>4. Seguridad de los Datos</h3>
    <p>
      Implementamos una variedad de medidas de seguridad para mantener la seguridad de tu informaci√≥n personal cuando ingresas, env√≠as o accedes a tu informaci√≥n personal.
    </p>

    <h3>5. Tus Derechos</h3>
    <p>
      Tienes derecho a acceder, rectificar, cancelar y oponerte al tratamiento de tus datos personales. Puedes ejercer estos derechos contact√°ndonos a trav√©s de la secci√≥n de Contacto de nuestra plataforma.
    </p>

    <h3>6. Cookies</h3>
    <p>
      MultiGenio utiliza cookies para mejorar la experiencia del usuario, personalizar el contenido y analizar el tr√°fico. Puedes configurar tu navegador para que rechace las cookies, pero esto podr√≠a afectar la funcionalidad de algunas partes de la plataforma.
    </p>

    <h3>7. Cambios en la Pol√≠tica de Privacidad</h3>
    <p>
      Podemos actualizar nuestra Pol√≠tica de Privacidad de vez en cuando. Te notificaremos cualquier cambio publicando la nueva Pol√≠tica de Privacidad en esta p√°gina. Te recomendamos revisar esta Pol√≠tica de Privacidad peri√≥dicamente para cualquier cambio.
    </p>

    <h3>8. Contacto</h3>
    <p>
      Si tienes alguna pregunta sobre esta Pol√≠tica de Privacidad, por favor cont√°ctanos a trav√©s de la secci√≥n de Contacto.
    </p>
  </div>


  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDklyhhZOV3c2KbbrvAZOpoUitPBWgRBOQ",
      authDomain: "multigenio-39890.firebaseapp.com",
      projectId: "multigenio-39890",
      storageBucket: "multigenio-39890.firebase-app.com",
      messagingSenderId: "881137429405",
      appId: "1:881137429405:web:9f061138bdf43b00dd5d74",
      measurementId: "G-9SQX18GVH6"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app); // Initialize Firebase Auth service
    const db = getFirestore(app); // Initialize Firestore

    // DOM elements
    const authModalOverlay = document.getElementById('auth-modal-overlay');
    const authContainer = document.getElementById('auth-container');
    const loginFormDiv = document.getElementById('login-form');
    const registerFormDiv = document.getElementById('register-form');
    const loginEmailInput = document.getElementById('login-email');
    const loginPasswordInput = document.getElementById('login-password');
    const registerEmailInput = document.getElementById('register-email');
    const registerPasswordInput = document.getElementById('register-password');
    const logoutButton = document.getElementById('logout-button');
    const quizNavLink = document.getElementById('quiz-nav-link');
    const authNavLink = document.getElementById('auth-nav-link');
    const guestModeButton = document.getElementById('guest-mode-button'); // New element for guest mode button

    const quizContainer = document.getElementById('quiz-container');
    const mainContent = document.getElementById('main-content');
    const questionText = document.getElementById('question-text');
    const optionsDiv = document.getElementById('options');
    const resultMessage = document.getElementById('result-message');
    const tdahWarning = document.getElementById('tdah-warning');
    const studyAdvice = document.getElementById('study-advice');
    const lessonContentDisplay = document.getElementById('lesson-content-display');
    const customMessage = document.getElementById('custom-message');
    const userIdDisplay = document.getElementById('user-id-display'); // New element for User ID

    // Review system elements
    const reviewsContainer = document.getElementById('reviews-container');
    const reviewForm = document.getElementById('review-form');
    const reviewTextarea = document.getElementById('review-text');
    const reviewRatingStars = document.getElementById('review-rating-stars');
    const selectedRatingInput = document.getElementById('selected-rating');
    const reviewAuthMessage = document.getElementById('review-auth-message');

    // New legal pages
    const terminosPage = document.getElementById('terminos-page');
    const politicasPage = document.getElementById('politicas-page');

    let isAuthenticated = false; // Flag to track authentication status
    let currentUserId = null; // Store the current user ID
    let currentUserName = null; // Store the current user's display name or email prefix
    let isGuestMode = false; // Flag for guest mode
    let userLearningStyle = 'visual'; // Default learning style, updated by quiz or Firestore
    let userTDAHStatus = 'no'; // Default TDAH status, updated by quiz or Firestore
    let userQuizCompleted = false; // Track if quiz is completed

    // Gemini API Configuration
    const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=";
    // !! IMPORTANTE !! Si est√°s ejecutando esta aplicaci√≥n fuera del entorno de Google Canvas,
    // DEBES reemplazar "TU_API_KEY_DE_GEMINI_AQUI" con tu propia clave API de Gemini.
    // Puedes obtener una clave API en Google AI Studio: https://makersuite.google.com/
    const GEMINI_API_KEY = ""; 

    // --- Utility Functions ---
    function showMessage(message, duration = 3000) {
        customMessage.textContent = message;
        customMessage.style.display = 'block';
        customMessage.classList.add('show');
        setTimeout(() => {
            customMessage.classList.remove('show');
            customMessage.style.display = 'none';
        }, duration);
    }

    function showElement(element) {
        element.style.display = 'block';
    }

    function hideElement(element) {
        element.style.display = 'none';
    }
    
    // Override for modal overlay to use flex for centering
    function showModalOverlay(element) {
        element.style.display = 'flex';
        element.classList.add('active');
    }

    function hideModalOverlay(element) {
        element.classList.remove('active');
        // Give time for transition before setting display to none
        setTimeout(() => {
            element.style.display = 'none';
        }, 300); // Match CSS transition duration
    }

    // --- Authentication Functions ---
    window.toggleAuthForm = function(formToShow) {
      if (formToShow === 'login') {
        showElement(loginFormDiv);
        hideElement(registerFormDiv);
      } else {
        hideElement(loginFormDiv);
        showElement(registerFormDiv);
      }
    }

    window.showAuthModal = function() {
        showModalOverlay(authModalOverlay); // Use new modal show function
        hideElement(mainContent);
        hideElement(quizContainer);
        hideElement(lessonContentDisplay);
        document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
        hideElement(terminosPage); // Ensure legal pages are hidden
        hideElement(politicasPage); // Ensure legal pages are hidden
        window.toggleAuthForm('login');
    }

    window.hideAuthModal = function() {
        hideModalOverlay(authModalOverlay); // Use new modal hide function
        if (isAuthenticated || isGuestMode) { // Show main content for authenticated or guest users
            showElement(mainContent);
        }
    }

    // Register user with email and password
    document.getElementById('register-email-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = registerEmailInput.value;
      const password = registerPasswordInput.value;

      try {
        await createUserWithEmailAndPassword(auth, email, password);
        showMessage('¬°Registro exitoso! Has iniciado sesi√≥n.');
        isGuestMode = false; // Exit guest mode if user registers
      } catch (error) {
        let errorMessage = 'Error al registrar: ';
        switch (error.code) {
            case 'auth/email-already-in-use':
                errorMessage += 'El correo electr√≥nico ya est√° en uso.';
                break;
            case 'auth/invalid-email':
                errorMessage += 'El formato del correo electr√≥nico no es v√°lido.';
                break;
            case 'auth/weak-password':
                errorMessage += 'La contrase√±a debe tener al menos 6 caracteres.';
                break;
            default:
                errorMessage += error.message;
        }
        showMessage(errorMessage, 5000);
        console.error("Error al registrar:", error);
      }
    });

    // Sign in user with email and password
    document.getElementById('login-email-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = loginEmailInput.value;
      const password = loginPasswordInput.value;

      try {
        await signInWithEmailAndPassword(auth, email, password);
        showMessage('¬°Inicio de sesi√≥n exitoso!');
        isGuestMode = false; // Exit guest mode if user logs in
      } catch (error) {
        let errorMessage = 'Error al iniciar sesi√≥n: ';
        switch (error.code) {
            case 'auth/invalid-credential':
                errorMessage += 'Credenciales inv√°lidas. Por favor, verifica tu correo y contrase√±a.';
                break;
            case 'auth/user-not-found':
            case 'auth/wrong-password':
                errorMessage += 'Correo o contrase√±a incorrectos.';
                break;
            case 'auth/invalid-email':
                errorMessage += 'El formato del correo electr√≥nico no es v√°lido.';
                break;
            default:
                errorMessage += error.message;
        }
        showMessage(errorMessage, 5000);
        console.error("Error al iniciar sesi√≥n:", error);
      }
    });

    // Guest mode button event listener
    guestModeButton.addEventListener('click', () => {
        isGuestMode = true;
        isAuthenticated = false; // Ensure not authenticated if guest
        currentUserId = null; // No specific user ID for guest mode
        currentUserName = "Invitado";
        window.hideAuthModal();
        showElement(mainContent);
        showMessage('Modo invitado activado. Algunas funciones de personalizaci√≥n y guardado no est√°n disponibles.', 5000);
        updateNavigationVisibility();
        window.updateQuizResultDisplay(); // Clear quiz result display
        updateReviewFormVisibility(); // Update review form for guests
    });

    // Logout button event listener
    logoutButton.addEventListener('click', async () => {
      try {
        await signOut(auth);
        isGuestMode = false; // Exit guest mode on logout
        showMessage('Has cerrado sesi√≥n.');
      } catch (error) {
        showMessage('Error al cerrar sesi√≥n: ' + error.message, 5000);
        console.error("Error al cerrar sesi√≥n:", error);
      }
    });

    function updateNavigationVisibility() {
        if (isAuthenticated) {
            showElement(quizNavLink);
            showElement(logoutButton);
            hideElement(authNavLink);
            hideElement(guestModeButton); // Hide guest button when logged in
            
            // Show/hide quiz nav link based on quiz completion status
            if (userQuizCompleted) {
                hideElement(quizNavLink);
            } else {
                showElement(quizNavLink);
            }

            hideElement(userIdDisplay); // Still keep user ID hidden

        } else if (isGuestMode) {
            hideElement(quizNavLink); // Guests cannot take quiz or save progress
            hideElement(logoutButton);
            hideElement(authNavLink); // Hide auth link if already in guest mode
            showElement(guestModeButton); // Keep guest button visible if it's the current mode
            hideElement(userIdDisplay);
            // Reset to default learning style for guest mode
            userLearningStyle = 'visual';
            userTDAHStatus = 'no';
            resultMessage.textContent = '';
            studyAdvice.textContent = '';
            hideElement(tdahWarning);
        } else { // Not authenticated, not guest mode (initial state or after logout)
            hideElement(quizNavLink);
            hideElement(logoutButton);
            showElement(authNavLink);
            showElement(guestModeButton); // Show guest button
            hideElement(userIdDisplay);
        }
        updateReviewFormVisibility(); // Ensure review form visibility is updated on auth state change
    }

    // Listen for authentication state changes
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        isAuthenticated = true;
        currentUserId = user.uid;
        currentUserName = user.email ? user.email.split('@')[0] : "Usuario"; // Set username from email prefix
        isGuestMode = false; // Ensure not in guest mode if authenticated
        window.hideAuthModal(); // Hide modal, show main content
        
        // Load user preferences BEFORE updating nav visibility
        await window.loadUserPreferences(user.uid); 
        updateNavigationVisibility(); // Update visibility based on auth status and loaded preferences
        showMessage('¬°Bienvenido de nuevo!');

        window.loadProgressAndDisplay(); // Refresh UI based on loaded progress
        window.updateAllProgressBars(); // Recalculate and update all progress bars
      } else {
        isAuthenticated = false;
        currentUserId = null;
        currentUserName = null; // Clear username on logout
        // Do not force show mainContent here, let specific functions handle it
        // based on guest mode or initial state.
        updateNavigationVisibility(); // Update visibility based on auth status (not authenticated)
        // Reset user preferences to default only if not in guest mode.
        if (!isGuestMode) {
            userLearningStyle = 'visual';
            userTDAHStatus = 'no';
            userQuizCompleted = false; // Reset quiz status
            resultMessage.textContent = '';
            studyAdvice.textContent = '';
            hideElement(tdahWarning);
        }
        showMessage('Inicia sesi√≥n o reg√≠strate para acceder a todas las funciones.', 5000);
      }
    });

    // --- Firestore Functions for User Preferences and Progress ---
    async function saveUserPreferences() {
        if (!isAuthenticated) {
            console.error("No user ID to save preferences. User is not authenticated.");
            showMessage("Por favor, inicia sesi√≥n para guardar tus preferencias.", 3000);
            return;
        }
        const userRef = doc(db, "users", currentUserId);
        try {
            await setDoc(userRef, {
                learningStyle: userLearningStyle,
                tdahStatus: userTDAHStatus,
                quizCompleted: true // Mark quiz as completed
            }, { merge: true });
            userQuizCompleted = true; // Update local state
            console.log("User preferences saved to Firestore.");
        } catch (e) {
            console.error("Error saving user preferences: ", e);
            showMessage("Error al guardar tus preferencias.", 3000);
        }
    }

    window.loadUserPreferences = async function(uid) { // Made global
        if (!isAuthenticated) {
            console.warn("Cannot load user preferences: User is not authenticated.");
            return;
        }
        const userRef = doc(db, "users", uid);
        try {
            const userSnap = await getDoc(userRef);
            if (userSnap.exists()) {
                const data = userSnap.data();
                userLearningStyle = data.learningStyle || 'visual';
                userTDAHStatus = data.tdahStatus || 'no';
                userQuizCompleted = data.quizCompleted || false; // Load quiz completion status
                console.log("User preferences loaded from Firestore:", data);
                
                // Update UI based on loaded preferences
                window.updateQuizResultDisplay(); // Call global version
            } else {
                console.log("No user preferences found in Firestore. User is new or quiz not completed.");
                // For new users, or users without preferences saved, the default 'visual' and 'no' will be used.
                userQuizCompleted = false; // Ensure it's false if no preferences found
            }
        } catch (e) {
            console.error("Error loading user preferences: ", e);
            showMessage("Error al cargar tus preferencias.", 3000);
        }
    }

    window.saveProgress = async function(subject, topicId, status) { // Made global
        if (!isAuthenticated) {
            console.error("No user ID to save progress. User is not authenticated.");
            showMessage("Por favor, inicia sesi√≥n para guardar tu progreso.", 3000);
            return;
        }
        const progressRef = doc(db, `users/${currentUserId}/progress`, `${subject}-${topicId}`);
        try {
            await setDoc(progressRef, { status: status, timestamp: new Date() }, { merge: true });
            console.log(`Progress for ${subject}-${topicId} saved.`);
            window.loadProgressAndDisplay(); // Call global version
            window.updateAllProgressBars(); // Call global version
        } catch (e) {
            console.error("Error al guardar el progreso: ", e);
            showMessage("Error al guardar tu progreso.", 3000);
        }
    }

    window.loadProgressAndDisplay = async function() { // Made global
        if (!isAuthenticated) {
            console.warn("No user ID to load progress. Displaying default progress.");
            // If not authenticated, ensure progress indicators are cleared.
            [
              ...mathTopics.map(t => ({ subject: 'matematicas', topic: t })),
              ...lenguaTopics.map(t => ({ subject: 'lengua', topic: t })),
              ...inglesTopics.map(t => ({ subject: 'ingles', topic: t }))
            ].forEach(({ subject, topic }) => {
              const indicator = document.getElementById(`progress-${subject}-${topic.id}`);
              if (indicator) {
                indicator.innerHTML = '';
              }
            });
            return;
        }

        try {
            const progressCollectionRef = collection(db, `users/${currentUserId}/progress`);
            const querySnapshot = await getDocs(progressCollectionRef);
            const userProgress = {};
            querySnapshot.forEach((doc) => {
                userProgress[doc.id] = doc.data().status;
            });

            // Make userProgress globally accessible for window.updateSubjectProgress
            window.userProgress = userProgress; 

            // Update individual topic indicators
            [
                ...mathTopics.map(t => ({ subject: 'matematicas', topic: t })),
                ...lenguaTopics.map(t => ({ subject: 'lengua', topic: t })),
                ...inglesTopics.map(t => ({ subject: 'ingles', topic: t }))
            ].forEach(({ subject, topic }) => {
                const docId = `${subject}-${topic.id}`;
                const status = userProgress[docId];
                const indicator = document.getElementById(`progress-${subject}-${topic.id}`);
                if (indicator) {
                    if (status === 'completed') {
                        indicator.innerHTML = '<span style="color: green; font-weight: bold; margin-left: 10px;">‚úÖ Completado</span>';
                    } else {
                        indicator.innerHTML = ''; // Limpiar si no est√° completado
                    }
                }
            });
            window.updateAllProgressBars(); // Call global version after loading all individual progress
        } catch (e) {
            console.error("Error al cargar el progreso: ", e);
            showMessage("Error al cargar tu progreso.", 3000);
        }
    }

    window.updateSubjectProgress = function(subject, topicsArray, progressFillId, progressTextId, progressContainerId) { // Added progressContainerId parameter
      let completedCount = 0;
      topicsArray.forEach(topic => {
          const progressKey = `${subject}-${topic.id}`; // This matches doc ID in Firestore
          if (window.userProgress && window.userProgress[progressKey] === 'completed') {
              completedCount++;
          }
      });

      const totalTopics = topicsArray.length;
      const percentage = totalTopics > 0 ? (completedCount / totalTopics) * 100 : 0;

      const progressBarFill = document.getElementById(progressFillId);
      const progressBarText = document.getElementById(progressTextId);
      const progressBarContainer = document.getElementById(progressContainerId); // Get the container element

      if (progressBarFill && progressBarText && progressBarContainer) { // Check if container exists
        progressBarFill.style.width = `${percentage}%`;
        progressBarText.textContent = `${Math.round(percentage)}% completado`;
        progressBarContainer.setAttribute('aria-valuenow', Math.round(percentage)); // Update ARIA attribute
      }
    }

    window.updateAllProgressBars = function() { // Made global
      window.updateSubjectProgress('matematicas', mathTopics, 'matematicas-progress-fill', 'matematicas-progress-text', 'matematicas-progress-container'); // Pass container ID
      window.updateSubjectProgress('lengua', lenguaTopics, 'lengua-progress-fill', 'lengua-progress-text', 'lengua-progress-container'); // Pass container ID
      window.updateSubjectProgress('ingles', inglesTopics, 'ingles-progress-fill', 'ingles-progress-text', 'ingles-progress-container'); // Pass container ID
    }

    window.updateQuizResultDisplay = function() { // Made global
        const styleNames = {
            visual: "Visual",
            auditivo: "Auditivo",
            'lectura-escritura': "Lectura/Escritura",
            kinestesico: "Kinest√©sico"
        };

        if (isAuthenticated) { // Only show personalized message if authenticated
            if (userLearningStyle) {
                resultMessage.textContent = `üéØ Tu estilo de aprendizaje principal detectado: ${styleNames[userLearningStyle]}.`;
                const adviceByStyle = {
                    visual: "Te recomendamos usar esquemas, mapas conceptuales, videos y colores para organizar tus ideas. Aprovecha im√°genes y gr√°ficos para estudiar de forma efectiva.",
                    auditivo: "Aprender√°s mejor con grabaciones, podcasts, explicaciones en voz alta y repitiendo la informaci√≥n oralmente. Considera escuchar tus apuntes.",
                    'lectura-escritura': "Tu fortaleza es procesar informaci√≥n a trav√©s de la lectura de textos, la toma de notas detalladas y la escritura de res√∫menes. Organiza tus ideas por escrito.",
                    kinestesico: "Para ti, es ideal aprender haciendo. Prefieres actividades pr√°cticas, experimentos y el movimiento f√≠sico durante el estudio para asimilar el conocimiento."
                };
                studyAdvice.textContent = `Consejo de estudio para tu estilo: ${adviceByStyle[userLearningStyle] || "No se encontr√≥ un consejo espec√≠fico para tu estilo de aprendizaje."}`;
                showElement(resultMessage);
                showElement(studyAdvice);
            } else { // No personalized style found for authenticated user, hide
                hideElement(resultMessage);
                hideElement(studyAdvice);
            }

            if (userTDAHStatus === 'tdah') {
                showElement(tdahWarning);
            } else {
                hideElement(tdahWarning);
            }
        } else { // Hide for guests or logged out users
            hideElement(resultMessage);
            hideElement(studyAdvice);
            hideElement(tdahWarning);
        }
    }

    // --- LLM Integration for Content Generation ---
    async function generateLessonContent(subject, topicId, learningStyle) {
        if (!GEMINI_API_KEY) {
            showMessage("Error: La clave API de Gemini no est√° configurada. Por favor, a√±√°dela para generar contenido con IA.", 10000);
            return "<p>Contenido no disponible. Por favor, configura tu clave API de Gemini.</p>";
        }

        showMessage("Generando contenido de lecci√≥n con IA...", 5000);
        let effectiveLearningStyle = learningStyle;
        if (isGuestMode) {
             effectiveLearningStyle = 'general'; // Use a general style for guests
        }
        const prompt = `Genera un contenido de lecci√≥n interactivo y conciso sobre "${topicId.replace(/-/g, ' ')}" dentro del tema de "${subject}" para un estudiante con estilo de aprendizaje "${effectiveLearningStyle}".
Incluye los siguientes elementos de forma relevante para el estilo de aprendizaje:
- **Im√°genes y esquemas visuales**: Usa etiquetas <img> con URLs de placehold.co (por ejemplo, https://placehold.co/600x400/eef5fb/34495e?text=Esquema+del+Tema). Para cada imagen, incluye un atributo alt que describa la imagen en espa√±ol.
- **Videos explicativos**: Usa etiquetas <video> con URLs de video de ejemplo (por ejemplo, https://www.w3schools.com/html/mov_bbb.mp4). Aseg√∫rate de incluir los atributos controls and poster (una imagen de placeholder para el poster).
- **Audios o podcasts**: Usa etiquetas <audio> con URLs de audio de ejemplo (por ejemplo, https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3). Incluye el atributo controls.
- **Ejercicios interactivos**: Incluye √°reas de texto (<textarea>) para respuestas o peque√±os problemas, y descripciones claras de c√≥mo el usuario puede interactuar.
- **Un placeholder para un juego interactivo**: Usa una div con la clase 'interactive-game-placeholder' para describir el juego (ej: <div class='interactive-game-placeholder'><p>Aqu√≠ ir√≠a un juego de arrastrar y soltar.</p></div>).
- **Contenido textual did√°ctico**: Usa etiquetas <h3>, <p> para explicaciones claras y concisas.

Aseg√∫rate de que el HTML generado sea v√°lido, limpio y atractivo. El contenido debe ser did√°ctico y atractivo, adaptado al estilo de aprendizaje especificado. Al final de la lecci√≥n, incluye un bot√≥n para simular la finalizaci√≥n de la lecci√≥n con el texto 'Completar lecci√≥n' o 'Simular Completar Juego'.`;

        try {
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
            };
            const apiUrl = `${GEMINI_API_URL}${GEMINI_API_KEY}`;
            console.log("Calling Gemini API with prompt:", prompt); // Log the prompt for debugging
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error("Gemini API network response was not ok:", response.status, errorText);
                showMessage(`Error al generar contenido (c√≥digo: ${response.status}). Int√©ntalo de nuevo.`, 5000);
                return "<p>Error al cargar el contenido de la lecci√≥n debido a un problema de red.</p>";
            }

            const result = await response.json();
            console.log("Gemini API response:", result); // Log the full response

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const htmlContent = result.candidates[0].content.parts[0].text;
                // Clean markdown backticks if LLM adds them
                return htmlContent.replace(/```html\n?|\n?```/g, '');
            } else {
                console.error("Unexpected LLM response structure or missing content:", result);
                showMessage("No se pudo generar el contenido de la lecci√≥n (estructura inesperada).", 5000);
                return "<p>Error: No se pudo generar el contenido. La IA no proporcion√≥ una respuesta v√°lida.</p>";
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            showMessage("Error de conexi√≥n con la IA. Verifica tu clave API y conexi√≥n a internet.", 7000);
            return "<p>Error de conexi√≥n al generar el contenido. Por favor, verifica tu clave API y conexi√≥n a internet.</p>";
        }
    }


    // --- Quiz Functions ---
    const quizQuestions = [
      {
        question: "Cuando aprendo algo nuevo, prefiero verlo representado visualmente (diagramas, gr√°ficos, videos).",
        type: "learning-style",
        style: "visual"
      },
      {
        question: "Recuerdo mejor la informaci√≥n si la escucho (lecturas en voz alta, debates, grabaciones).",
        type: "learning-style",
        style: "auditivo"
      },
      {
        question: "Disfruto tomando apuntes detallados y leyendo textos para comprender un tema.",
        type: "learning-style",
        style: "lectura-escritura"
      },
      {
        question: "Necesito manipular objetos o realizar actividades pr√°cticas para asimilar el conocimiento.",
        type: "learning-style",
        style: "kinestesico"
      },
      {
        question: "Las im√°genes y los colores me ayudan significativamente a organizar y recordar la informaci√≥n.",
        type: "learning-style",
        style: "visual"
      },
      {
        question: "Cuando estudio, me beneficia escuchar explicaciones o podcasts sobre el tema.",
        type: "learning-style",
        style: "auditivo"
      },
      {
        question: "Prefiero resumir la informaci√≥n en mis propias palabras o crear listas para memorizar.",
        type: "learning-style",
        style: "lectura-escritura"
      },
      {
        question: "Me siento m√°s c√≥modo aprendiendo a trav√©s de la experimentaci√≥n o el movimiento f√≠sico.",
        type: "learning-style",
        style: "kinestesico"
      },
      {
        question: "Me distraigo f√°cilmente con est√≠mulos externos cuando intento concentrarme.",
        type: "tdah"
      },
      {
        question: "Los videos tutoriales o las animaciones son mis herramientas favoritas para aprender.",
        type: "learning-style",
        style: "visual"
      },
      {
        question: "Me gusta participar en discusiones grupales o explicar conceptos a otros para entenderlos mejor.",
        type: "learning-style",
        style: "auditivo"
      },
      {
        question: "Subrayar y hacer esquemas escritos me ayuda mucho a comprender la lectura.",
        type: "learning-style",
        style: "lectura-escritura"
      },
      {
        question: "Necesito moverme o gesticular mientras pienso para procesar ideas complejas.",
        type: "learning-style",
        style: "kinestesico"
      },
      {
        question: "A menudo me cuesta terminar tareas que requieren un esfuerzo mental sostenido.",
        type: "tdah"
      },
      {
        question: "Cuando se me explica algo, prefiero que se use un pizarr√≥n o diapositivas con muchos gr√°ficos.",
        type: "learning-style",
        style: "visual"
      },
      {
        question: "Si quiero aprender un idioma, la pronunciaci√≥n y la escucha son lo primero para m√≠.",
        type: "learning-style",
        style: "auditivo"
      },
      {
        question: "Disfruto leyendo art√≠culos cient√≠ficos o novelas complejas.",
        type: "learning-style",
        style: "lectura-escritura"
      },
      {
        question: "Siento la necesidad de 'tocar' o 'construir' modelos para entender c√≥mo funcionan las cosas.",
        type: "learning-style",
        style: "kinestesico"
      },
      {
        question: "Me cuesta organizar mis tareas o actividades.",
        type: "tdah"
      },
      {
        question: "Prefiero los libros de texto con muchas ilustraciones y poco texto denso.",
        type: "learning-style",
        style: "visual"
      },
      {
        question: "Cuando estoy en una clase o conferencia, aprendo m√°s si el orador habla claro y con ejemplos verbales.",
        type: "learning-style",
        style: "auditivo"
      },
      {
        question: "Me gusta escribir ensayos o informes detallados sobre los temas que estudio.",
        type: "learning-style",
        style: "lectura-escritura"
      },
      {
        question: "Aprender un deporte o un instrumento musical me resulta m√°s f√°cil que aprender una teor√≠a abstracta.",
        type: "learning-style",
        style: "kinestesico"
      },
      {
        question: "Con frecuencia olvido citas o lo que iba a decir a mitad de una conversaci√≥n.",
        type: "tdah"
      },
      {
        question: "Me resulta dif√≠cil esperar mi turno en conversaciones o actividades grupales.",
        type: "tdah"
      }
    ];

    let currentQuestionIndex = 0;
    let selectedAnswersScores = {}; // To store the numerical score for each question

    window.showQuestion = function() {
      if (!isAuthenticated) {
        showMessage('Por favor, inicia sesi√≥n para acceder al cuestionario y guardar tus preferencias.', 4000);
        window.showAuthModal();
        return;
      }
      if (userQuizCompleted) {
          showMessage('Ya has completado el cuestionario de estilo de aprendizaje. Puedes continuar explorando las materias.', 4000);
          window.showMainContent(); // Return to main content if quiz already done
          return;
      }
      console.log('--- showQuestion called ---');
      console.log('Current index:', currentQuestionIndex);

      // Hide all other content explicitly
      hideElement(mainContent);
      document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
      hideElement(lessonContentDisplay);
      hideModalOverlay(authModalOverlay); // Ensure modal is not active
      hideElement(terminosPage); // Ensure legal pages are hidden
      hideElement(politicasPage); // Ensure legal pages are hidden

      // Show quiz container
      showElement(quizContainer);
      console.log('Quiz container display set to block.');

      if (currentQuestionIndex >= quizQuestions.length) {
        console.log('Quiz finished. Calling finishQuiz().');
        finishQuiz();
        return;
      }

      const currentQ = quizQuestions[currentQuestionIndex];
      questionText.textContent = currentQ.question;
      optionsDiv.innerHTML = '';
      console.log('Displaying question:', currentQ.question);
      
      // Create 1-5 scale buttons
      const scaleOptions = [
          "Totalmente en desacuerdo",
          "En desacuerdo",
          "Neutral",
          "De acuerdo",
          "Totalmente de acuerdo"
      ];

      for (let i = 1; i <= 5; i++) {
        const btn = document.createElement('button');
        btn.textContent = `${i} - ${scaleOptions[i-1]}`;
        btn.onclick = () => {
          selectedAnswersScores[currentQuestionIndex] = i; // Store the numerical score
          currentQuestionIndex++;
          console.log('Option selected. Next question index:', currentQuestionIndex);
          window.showQuestion();
        };
        btn.setAttribute('aria-label', `${i} ${scaleOptions[i-1]}`); // Accessibility
        optionsDiv.appendChild(btn);
        console.log('Added option button:', btn.textContent);
      }
    }

    async function finishQuiz() {
      console.log('--- finishQuiz called ---');
      hideElement(quizContainer);
      showElement(mainContent); // Ensure main content is shown

      const learningStyleScores = {
        visual: 0,
        auditivo: 0,
        'lectura-escritura': 0,
        kinestesico: 0
      };
      let tdahSeverityScore = 0;
      let tdahQuestionsCount = 0;


      // Calculate scores for learning styles and TDAH
      for (let i = 0; i < quizQuestions.length; i++) {
          const question = quizQuestions[i];
          const score = selectedAnswersScores[i];

          if (question.type === 'learning-style') {
              learningStyleScores[question.style] += score;
          } else if (question.type === 'tdah') {
              tdahSeverityScore += score; // Add the 1-5 score to TDAH
              tdahQuestionsCount++;
          }
      }

      // Determine the main learning style
      let maxStyle = 'visual';
      let maxScore = -1; // Initialize with a value lower than any possible score
      for (const style in learningStyleScores) {
          if (learningStyleScores[style] > maxScore) {
              maxScore = learningStyleScores[style];
              maxStyle = style;
          }
      }
      userLearningStyle = maxStyle; // Update global variable

      // Determine TDAH status based on a threshold
      // The threshold can be adjusted based on desired sensitivity and number of TDAH questions
      // For example, if avg score is 3.5 or higher (out of 5) on TDAH questions
      const averageTDAHScore = tdahQuestionsCount > 0 ? tdahSeverityScore / tdahQuestionsCount : 0;
      const tdahThresholdAverage = 3.5; // Adjust this value as needed (e.g., 3 = neutral, 4 = leaning towards agreement)
      userTDAHStatus = averageTDAHScore >= tdahThresholdAverage ? 'tdah' : 'no'; // Update global variable

      window.updateQuizResultDisplay(); // Update UI based on final style and TDAH status
      await saveUserPreferences(); // Save preferences to Firestore
      updateNavigationVisibility(); // Update navigation after quiz completion

      window.loadProgressAndDisplay(); // Use global version
      window.updateAllProgressBars(); // Use global version
    }

    // --- Data de Temas para C√°lculo de Progreso ---
    const mathTopics = [
      { id: 'operaciones-basicas', text: 'Operaciones B√°sicas' },
      { id: 'fracciones', text: 'Fracciones y Decimales' },
      { id: 'porcentajes', text: 'Porcentajes' },
      { id: 'ecuaciones', text: 'Ecuaciones de Primer Grado' },
      { id: 'sistemas', text: 'Sistemas de Ecuaciones' },
      { id: 'geometria', text: 'Geometr√≠a B√°sica' }
    ];

    const lenguaTopics = [
      { id: 'ortografia-basica', text: 'Ortograf√≠a B√°sica' },
      { id: 'morfologia', text: 'Morfolog√≠a' },
      { id: 'sintaxis-simple', text: 'Sintaxis - Oraci√≥n Simple' },
      { id: 'sintaxis-compuesta', text: 'Sintaxis - Oraci√≥n Compuesta' },
      { id: 'literatura', text: 'Literatura Espa√±ola' },
      { id: 'expresion-escrita', text: 'Expresi√≥n Escrita' }
    ];

    const inglesTopics = [
      { id: 'basic-vocabulary', text: 'Basic Vocabulary' },
      { id: 'present-tenses', text: 'Present Simple & Continuous' },
      { id: 'past-tenses', text: 'Past Simple & Past Continuous' },
      { id: 'future-tenses', text: 'Future Tenses' },
      { id: 'conditionals', text: 'Conditionals' },
      { id: 'listening-speaking', text: 'Listening & Speaking' }
    ];


    // --- Funciones de Navegaci√≥n y Contenido ---
    window.showSubject = function(subject) {
      // Allow guests to see subjects, but warn about personalization
      if (!isAuthenticated && !isGuestMode) {
        showMessage('Por favor, inicia sesi√≥n o usa el modo invitado para acceder a las materias.', 4000);
        window.showAuthModal();
        return;
      }
      console.log('--- showSubject called ---');
      hideElement(mainContent);
      hideElement(quizContainer);
      document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
      hideElement(lessonContentDisplay);
      hideModalOverlay(authModalOverlay); // Ensure modal is not active
      hideElement(terminosPage); // Ensure legal pages are hidden
      hideElement(politicasPage); // Ensure legal pages are hidden

      const subjectPage = document.getElementById(subject + '-page');
      if (subjectPage) {
        showElement(subjectPage);
      }
      
      personalizeSubjectIntro(subject);
      // Only load and update progress if authenticated, otherwise it's just topic list
      if (isAuthenticated) {
          window.loadProgressAndDisplay(); // Call global version to load and display individual topic progress checks
          window.updateAllProgressBars(); // Call global version to update overall subject progress bars
      } else {
          // Clear progress indicators for guest mode
          [
              ...mathTopics.map(t => ({ subject: 'matematicas', topic: t })),
              ...lenguaTopics.map(t => ({ subject: 'lengua', topic: t })),
              ...inglesTopics.map(t => ({ subject: 'ingles', topic: t }))
            ].forEach(({ subject: sub, topic: tpc }) => {
              const indicator = document.getElementById(`progress-${sub}-${tpc.id}`);
              if (indicator) {
                indicator.innerHTML = '';
              }
            });
            const allProgressBars = document.querySelectorAll('.progress-bar-fill');
            allProgressBars.forEach(bar => bar.style.width = '0%');
            const allProgressTexts = document.querySelectorAll('.progress-text');
            allProgressTexts.forEach(text => text.textContent = '0% completado');
      }
    }

    window.showMainContent = function() {
      console.log('--- showMainContent called ---');
      document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
      hideElement(quizContainer);
      hideElement(lessonContentDisplay);
      hideModalOverlay(authModalOverlay); // Ensure modal is not active
      hideElement(terminosPage); // Ensure legal pages are hidden
      hideElement(politicasPage); // Ensure legal pages are hidden
      
      showElement(mainContent);
    }

    // New functions to show legal pages
    window.showTerminos = function() {
        hideElement(mainContent);
        hideElement(quizContainer);
        document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
        hideElement(lessonContentDisplay);
        hideModalOverlay(authModalOverlay);
        hideElement(politicasPage);
        showElement(terminosPage);
        window.scrollTo(0,0); // Scroll to top
    }

    window.showPoliticas = function() {
        hideElement(mainContent);
        hideElement(quizContainer);
        document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
        hideElement(lessonContentDisplay);
        hideModalOverlay(authModalOverlay);
        hideElement(terminosPage);
        showElement(politicasPage);
        window.scrollTo(0,0); // Scroll to top
    }


    function personalizeSubjectIntro(subject) {
      const introElement = document.getElementById(subject + '-personalized-intro');
      if (!introElement) return;

      let introText = "";
      if (isAuthenticated && userLearningStyle) {
          const personalizedIntros = {
            matematicas: {
              visual: "üé® Como eres una persona con estilo **visual**, hemos preparado esquemas, gr√°ficos y representaciones visuales para cada tema de matem√°ticas. ¬°Ver√°s las matem√°ticas de una forma completamente nueva!",
              auditivo: "üîä Perfecto para tu estilo **auditivo**: cada lecci√≥n incluye explicaciones paso a paso, podcasts matem√°ticos y ejercicios que puedes resolver 'hablando' contigo mismo.",
              'lectura-escritura': "üìù Ideal para tu estilo de **lectura/escritura**: encontrar√°s res√∫menes detallados, ejercicios escritos y la posibilidad de tomar notas estructuradas en cada tema.",
              kinestesico: "üèÉ ¬°Matem√°ticas en movimiento! Hemos dise√±ado actividades pr√°cticas, manipulativas y ejercicios que puedes resolver movi√©ndote o usando objetos f√≠sicos."
            },
            lengua: {
              visual: "üé® Tu aprendizaje **visual** te ayudar√° con mapas mentales, esquemas de sintaxis y representaciones gr√°ficas de las reglas gramaticales.",
              auditivo: "üîä Perfecto para tu estilo: lecturas en voz alta, ejercicios de dictado, y t√©cnicas de memorizaci√≥n con ritmo y sonidos.",
              'lectura-escritura': "üìù En tu elemento: an√°lisis de textos, ejercicios de escritura creativa y t√©cnicas de estudio basadas en la lectura comprensiva.",
              kinestesico: "üèÉ Lengua activa: dramatizaciones, juegos de roles y ejercicios donde puedas moverte mientras aprendes gram√°tica y literatura."
            },
            ingles: {
              visual: "üé® **Visual English**: flashcards, mind maps, videos y material gr√°fico para aprender vocabulario y gram√°tica de forma visual.",
              auditivo: "üîä Perfect for you: **listening exercises**, pronunciation practice, songs and audio materials to improve your English naturally.",
              'lectura-escritura': "üìù **Reading & Writing** focus: textos graduados, ejercicios de escritura y t√©cnicas de estudio basadas en la lectura en ingl√©s.",
              kinestesico: "üèÉ **Active English**: role-plays, interactive games y actividades pr√°cticas para aprender ingl√©s movi√©ndote y experimentando."
            }
          };
          introText = personalizedIntros[subject] && personalizedIntros[subject][userLearningStyle];
          if (introText) {
            introText = `<strong>Personalizado para ti:</strong><br>${introText}`;
          } else {
            introText = "¬°Bienvenido a la secci√≥n de " + subject.charAt(0).toUpperCase() + subject.slice(1) + "! Explora nuestros temas.";
          }
      } else {
          introText = "¬°Bienvenido a la secci√≥n de " + subject.charAt(0).toUpperCase() + subject.slice(1) + "! Para una experiencia de aprendizaje personalizada, inicia sesi√≥n o reg√≠strate.";
      }
      
      introElement.innerHTML = `<div style="background: #eef5fb; padding: 25px; border-radius: var(--border-radius-soft); margin-bottom: 30px; border-left: 6px solid var(--secondary-color); font-size: 1.05em; line-height: 1.6; color: var(--text-dark); box-shadow: 0 2px 10px rgba(0,0,0,0.05);">${introText}</div>`;
    }

    // --- Lesson Content Display (uses LLM for content) ---
    window.showLessonContent = async function(subject, topicId) {
        if (!isAuthenticated && !isGuestMode) {
            showMessage('Por favor, inicia sesi√≥n o usa el modo invitado para acceder al contenido de las lecciones.', 4000);
            window.showAuthModal();
            return;
        }
        console.log('--- showLessonContent called ---');
        hideElement(mainContent);
        hideElement(quizContainer);
        document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
        hideModalOverlay(authModalOverlay); // Ensure modal is not active
        hideElement(terminosPage); // Ensure legal pages are hidden
        hideElement(politicasPage); // Ensure legal pages are hidden

        showElement(lessonContentDisplay);

        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonMaterialElement = document.getElementById('lesson-material');

        const topicName = topicId.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        const subjectName = subject.charAt(0).toUpperCase() + subject.slice(1);
        lessonTitleElement.textContent = `Lecci√≥n: ${topicName} de ${subjectName}`;
        lessonMaterialElement.innerHTML = '<p style="text-align: center; margin-top: 50px; font-size: 1.2em; color: var(--text-light);">Cargando contenido de la lecci√≥n...</p>'; // Loading indicator

        // Generate content using LLM
        const generatedContent = await generateLessonContent(subject, topicId, userLearningStyle);
        lessonMaterialElement.innerHTML = generatedContent;

        // Add event listener to the "Completar lecci√≥n" button within the generated content
        // This assumes the generated content will include a button with this specific text and purpose.
        const completeLessonButton = lessonMaterialElement.querySelector('button');
        if (completeLessonButton && (completeLessonButton.textContent.includes('Completar lecci√≥n') || completeLessonButton.textContent.includes('Simular Completar Juego'))) {
            // Only allow completion if authenticated
            if (isAuthenticated) {
                completeLessonButton.onclick = () => window.simulateGameCompletion(subject, topicId);
            } else {
                completeLessonButton.style.display = 'none'; // Hide button for guests
                const completeMessage = document.createElement('p');
                completeMessage.textContent = 'Inicia sesi√≥n para guardar tu progreso de esta lecci√≥n.';
                completeMessage.style.color = 'var(--accent-color)';
                completeMessage.style.fontWeight = 'bold';
                lessonMaterialElement.appendChild(completeMessage);
            }
        }
    }

    window.hideLessonContent = function() {
        console.log('--- hideLessonContent called ---');
        hideElement(lessonContentDisplay);

        let previouslyActiveSubjectId = null;
        document.querySelectorAll('.subject-page').forEach(page => {
            if (page.style.display === 'block') { // Check for active display
                previouslyActiveSubjectId = page.id.replace('-page', '');
                // No se remueve la clase 'active' aqu√≠, ya que `showSubject` la gestionar√°.
                // Simplemente marcamos que exist√≠a una p√°gina activa.
            }
        });
        
        // Si hab√≠a una p√°gina de asignatura activa, mostrarla de nuevo.
        // Si no, volver al contenido principal.
        if (previouslyActiveSubjectId) {
            window.showSubject(previouslyActiveSubjectId); // Re-activa la p√°gina de asignatura espec√≠fica
        } else {
            window.showMainContent(); // Vuelve a la p√°gina principal
        }
    }

    window.simulateGameCompletion = function(subject, topicId) {
        if (!isAuthenticated) {
            showMessage("Necesitas iniciar sesi√≥n para guardar el progreso.", 3000);
            return;
        }
        showMessage('¬°Felicidades! Has completado el juego interactivo. Tu progreso ha sido guardado.', 4000);
        window.saveProgress(subject, topicId, 'completed'); // Call global version
        window.hideLessonContent();
    }

    // --- Review System Functions ---
    let currentRating = 0; // To store the selected rating for a new review

    reviewRatingStars.querySelectorAll('button').forEach(starButton => {
        starButton.addEventListener('click', () => {
            currentRating = parseInt(starButton.dataset.rating);
            selectedRatingInput.value = currentRating;
            updateStarDisplay();
        });
    });

    function updateStarDisplay() {
        reviewRatingStars.querySelectorAll('button').forEach(starButton => {
            const rating = parseInt(starButton.dataset.rating);
            if (rating <= currentRating) {
                starButton.classList.add('selected');
            } else {
                starButton.classList.remove('selected');
            }
        });
    }

    reviewForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!isAuthenticated) {
            showMessage("Debes iniciar sesi√≥n para enviar una rese√±a.", 3000);
            return;
        }
        if (currentRating === 0) {
            showMessage("Por favor, selecciona una calificaci√≥n en estrellas.", 3000);
            return;
        }

        const reviewText = reviewTextarea.value.trim();
        if (!reviewText) {
            showMessage("Por favor, escribe tu rese√±a antes de enviarla.", 3000);
            return;
        }

        try {
            const reviewsCollectionRef = collection(db, "reviews");
            await addDoc(reviewsCollectionRef, {
                userId: currentUserId,
                userName: currentUserName, // Use the stored user name
                text: reviewText,
                rating: currentRating,
                timestamp: serverTimestamp()
            });
            showMessage("¬°Gracias! Tu rese√±a ha sido enviada.", 4000);
            reviewTextarea.value = ''; // Clear form
            currentRating = 0;
            selectedRatingInput.value = 0;
            updateStarDisplay();
        } catch (error) {
            console.error("Error al enviar la rese√±a:", error);
            showMessage("Error al enviar la rese√±a: " + error.message, 5000);
        }
    });

    function renderReviews(reviews) {
        reviewsContainer.innerHTML = ''; // Clear previous reviews
        if (reviews.length === 0) {
            reviewsContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">A√∫n no hay rese√±as. ¬°S√© el primero en dejar una!</p>';
            return;
        }
        reviews.forEach(review => {
            const reviewCard = document.createElement('div');
            reviewCard.classList.add('review-card');
            reviewCard.innerHTML = `
                <p class="review-text">"${review.text}"</p>
                <div class="review-rating">${'‚≠ê'.repeat(review.rating)}</div>
                <p class="reviewer-name">${review.userName || 'An√≥nimo'}</p>
            `;
            reviewsContainer.appendChild(reviewCard);
        });
    }

    function updateReviewFormVisibility() {
        if (isAuthenticated) {
            showElement(reviewForm);
            hideElement(reviewAuthMessage);
        } else {
            hideElement(reviewForm);
            showElement(reviewAuthMessage);
        }
    }

    // --- Initial setup on page load ---
    document.addEventListener('DOMContentLoaded', async function() {
        // Explicitly hide all content areas that are not the main content by default
        hideElement(quizContainer);
        document.querySelectorAll('.subject-page').forEach(page => hideElement(page));
        hideElement(lessonContentDisplay);
        hideElement(customMessage); // Ensure custom message is hidden
        hideModalOverlay(authModalOverlay); // Ensure modal is hidden using its CSS class
        hideElement(terminosPage); // Ensure legal pages are hidden
        hideElement(politicasPage); // Ensure legal pages are hidden

        // Try to sign in anonymously for a seamless guest experience or if no auth token is available (e.g., GitHub)
        try {
            await signInAnonymously(auth);
            // onAuthStateChanged will handle setting isAuthenticated/isGuestMode and visibility
        } catch (error) {
            console.warn("Failed to sign in anonymously:", error);
            isAuthenticated = false;
            currentUserId = null;
            isGuestMode = false;
            updateNavigationVisibility(); // Ensure correct nav state if anonymous fails
            showElement(mainContent); // Show main content if no auth possible
        }

        // Display the main content initially until Firebase auth state determines otherwise.
        showElement(mainContent);
        
        // Load reviews initially and listen for real-time updates
        const reviewsCollectionRef = collection(db, "reviews");
        onSnapshot(query(reviewsCollectionRef, orderBy("timestamp", "desc")), (snapshot) => {
            const reviews = [];
            snapshot.forEach(doc => {
                reviews.push(doc.data());
            });
            renderReviews(reviews);
        }, (error) => {
            console.error("Error al cargar las rese√±as en tiempo real: ", error);
            showMessage("Error al cargar las rese√±as.", 3000);
        });

        updateStarDisplay(); // Initialize star display
    });
  
  </script>
</body>
</html>
